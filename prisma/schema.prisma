generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      String   @default("VIEWER")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  propertyOwnerships PropertyOwnership[]
  transactionSplits  TransactionSplit[]
  paidTransactions   Transaction[]       @relation("PaidByUser")
  settlementsFrom    Settlement[]        @relation("SettlementsFrom")
  settlementsTo      Settlement[]        @relation("SettlementsTo")

  @@map("users")
}

model Property {
  id            String   @id @default(uuid())
  name          String
  street        String
  city          String
  county        String
  postcode      String
  propertyType  String   @map("property_type")
  purchaseDate  DateTime? @map("purchase_date")
  purchasePrice Float?    @map("purchase_price")
  status        String
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  leases       Lease[]
  transactions Transaction[]
  events       Event[]
  ownerships   PropertyOwnership[]
  settlements  Settlement[]

  @@map("properties")
}

model Tenant {
  id                    String   @id @default(uuid())
  firstName             String   @map("first_name")
  lastName              String   @map("last_name")
  email                 String
  phone                 String
  emergencyContactName  String?  @map("emergency_contact_name")
  emergencyContactPhone String?  @map("emergency_contact_phone")
  status                String
  notes                 String?
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  leases    Lease[]

  @@map("tenants")
}

model Lease {
  id                      String    @id @default(uuid())
  propertyId              String    @map("property_id")
  tenantId                String    @map("tenant_id")
  startDate               DateTime  @map("start_date")
  endDate                 DateTime? @map("end_date")
  monthlyRent             Float     @map("monthly_rent")
  securityDepositAmount   Float     @map("security_deposit_amount")
  securityDepositPaidDate DateTime? @map("security_deposit_paid_date")
  status                  String
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")

  property     Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("leases")
}

model Transaction {
  id              String   @id @default(uuid())
  propertyId      String   @map("property_id")
  leaseId         String?  @map("lease_id")
  type            String
  category        String
  amount          Float
  transactionDate DateTime @map("transaction_date")
  description     String
  paidByUserId    String?  @map("paid_by_user_id")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  property  Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  lease     Lease?     @relation(fields: [leaseId], references: [id], onDelete: SetNull)
  paidBy    User?      @relation("PaidByUser", fields: [paidByUserId], references: [id], onDelete: SetNull)
  splits    TransactionSplit[]

  @@map("transactions")
}

model Event {
  id            String    @id @default(uuid())
  propertyId    String    @map("property_id")
  eventType     String    @map("event_type")
  title         String
  description   String?
  scheduledDate DateTime  @map("scheduled_date")
  completed     Boolean   @default(false)
  completedDate DateTime? @map("completed_date")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("events")
}

model Document {
  id         String   @id @default(uuid())
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id")
  fileName   String   @map("file_name")
  filePath   String   @map("file_path")
  fileType   String   @map("file_type")
  fileSize   Int      @map("file_size")
  uploadedAt DateTime @default(now()) @map("uploaded_at")

  @@map("documents")
}

model PropertyOwnership {
  id                  String   @id @default(uuid())
  userId              String   @map("user_id")
  propertyId          String   @map("property_id")
  ownershipPercentage Float    @map("ownership_percentage")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@unique([userId, propertyId])
  @@map("property_ownership")
}

model TransactionSplit {
  id            String   @id @default(uuid())
  transactionId String   @map("transaction_id")
  userId        String   @map("user_id")
  percentage    Float
  amount        Float
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([transactionId, userId])
  @@map("transaction_splits")
}

model Settlement {
  id             String   @id @default(uuid())
  fromUserId     String   @map("from_user_id")
  toUserId       String   @map("to_user_id")
  propertyId     String   @map("property_id")
  amount         Float
  settlementDate DateTime @map("settlement_date")
  notes          String?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  fromUser User     @relation("SettlementsFrom", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser   User     @relation("SettlementsTo", fields: [toUserId], references: [id], onDelete: Cascade)
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("settlements")
}
