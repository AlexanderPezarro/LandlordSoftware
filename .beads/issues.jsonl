{"id":"LandlordSoftware-a5n","title":"Database Schema \u0026 Prisma Models","description":"Create complete Prisma schema with all models: Properties, Tenants, Leases, Transactions, Documents, Events","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2026-01-08T17:33:19.954476752Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-a5n","depends_on_id":"LandlordSoftware-xy9","type":"blocks","created_at":"2026-01-08T19:14:05.327030552Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-a5n.1","title":"Create Properties Model","description":"Add PropertyStatus and PropertyType enums. Create Property model with UK address fields (street, city, county, postcode). Run migration.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:33:59.282958367Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-a5n.1","depends_on_id":"LandlordSoftware-a5n","type":"parent-child","created_at":"2026-01-08T17:33:59.301553674Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-a5n.2","title":"Create Tenants and Leases Models","description":"Add TenantStatus and LeaseStatus enums. Create Tenant model with contact info. Create Lease model linking properties and tenants. Run migration.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:34:00.427977421Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-a5n.2","depends_on_id":"LandlordSoftware-a5n","type":"parent-child","created_at":"2026-01-08T17:34:00.44227298Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-a5n.3","title":"Create Transactions and Documents Models","description":"Add TransactionType and EntityType enums. Create Transaction model for income/expenses. Create Document model for file attachments. Run migration.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:34:01.598877363Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-a5n.3","depends_on_id":"LandlordSoftware-a5n","type":"parent-child","created_at":"2026-01-08T17:34:01.611473503Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-a5n.4","title":"Create Events Model","description":"Add EventType enum. Create Event model for calendar scheduling linked to properties. Track completion status. Run migration and generate Prisma Client.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:34:02.705189686Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-a5n.4","depends_on_id":"LandlordSoftware-a5n","type":"parent-child","created_at":"2026-01-08T17:34:02.72083296Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-hly","title":"Properties API \u0026 Services","description":"Create backend API routes and services for property CRUD operations","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-08T17:33:22.218178603Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-hly","depends_on_id":"LandlordSoftware-sx2","type":"blocks","created_at":"2026-01-08T19:14:07.326463119Z","created_by":"stuff"},{"issue_id":"LandlordSoftware-hly","depends_on_id":"LandlordSoftware-a5n","type":"blocks","created_at":"2026-01-08T19:14:08.03305555Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-hly.1","title":"Create Properties API Routes","description":"Create PropertyService for database operations. Implement CRUD endpoints (GET, POST, PUT, DELETE). Include related data in detail view. Protect with auth middleware.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-08T17:34:20.177614079Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-hly.1","depends_on_id":"LandlordSoftware-hly","type":"parent-child","created_at":"2026-01-08T17:34:20.188979105Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-hly.2","title":"Create Properties Frontend Service","description":"Create base axios API client with auth interceptor. Add property types. Implement propertyService for API calls with auto-redirect on 401.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-08T17:34:21.225555437Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-hly.2","depends_on_id":"LandlordSoftware-hly","type":"parent-child","created_at":"2026-01-08T17:34:21.237606271Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-pbk","title":"Properties Frontend UI","description":"Create properties list page with Material-UI components and property management","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-08T17:33:24.528002273Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-pbk","depends_on_id":"LandlordSoftware-zcm","type":"blocks","created_at":"2026-01-08T19:14:10.790653265Z","created_by":"stuff"},{"issue_id":"LandlordSoftware-pbk","depends_on_id":"LandlordSoftware-hly","type":"blocks","created_at":"2026-01-08T19:14:11.520639102Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-pbk.1","title":"Create Properties List Page","description":"Create Layout component with navigation drawer. Build PropertyCard component. Implement Properties page with list view. Add edit and delete actions. Integrate with propertyService.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-08T17:34:35.43048433Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-pbk.1","depends_on_id":"LandlordSoftware-pbk","type":"parent-child","created_at":"2026-01-08T17:34:35.448771834Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-sx2","title":"Authentication System","description":"Implement backend authentication with sessions, bcrypt, and protected routes","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-08T17:33:21.091742638Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-sx2","depends_on_id":"LandlordSoftware-a5n","type":"blocks","created_at":"2026-01-08T19:14:06.33627924Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-sx2.1","title":"Create Authentication Middleware","description":"Create auth middleware for protected routes. Setup express-session with SQLite store. Configure helmet and rate limiting. Add session types.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-08T17:34:10.643260884Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-sx2.1","depends_on_id":"LandlordSoftware-sx2","type":"parent-child","created_at":"2026-01-08T17:34:10.65548622Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-sx2.2","title":"Create Auth Routes","description":"Create AuthService with bcrypt password hashing. Implement login, logout, me, and setup endpoints. Register routes in server.ts.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-08T17:34:11.744382844Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-sx2.2","depends_on_id":"LandlordSoftware-sx2","type":"parent-child","created_at":"2026-01-08T17:34:11.759776615Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-xy9","title":"Project Setup \u0026 Configuration","description":"Initialize Node.js monorepo with TypeScript, setup backend with Express/Prisma, and frontend with Vite/React/Material-UI","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2026-01-08T17:33:18.803182707Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"All children completed","created_by":"stuff","deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-xy9.1","title":"Initialize Node.js Project Structure","description":"Create package.json, tsconfig files, and directory structure for server and client. Install TypeScript and base dependencies.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:33:42.853789166Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-xy9.1","depends_on_id":"LandlordSoftware-xy9","type":"parent-child","created_at":"2026-01-08T17:33:42.87206947Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-xy9.2","title":"Setup Backend Dependencies","description":"Install Express, Prisma, session management, validation (Zod), security middleware (helmet, rate-limit), and create basic server.ts","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:33:44.085853303Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-xy9.2","depends_on_id":"LandlordSoftware-xy9","type":"parent-child","created_at":"2026-01-08T17:33:44.104784214Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-xy9.3","title":"Setup Prisma Database","description":"Initialize Prisma with SQLite, create initial User model, configure .env, and run first migration","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:33:45.318676748Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-xy9.3","depends_on_id":"LandlordSoftware-xy9","type":"parent-child","created_at":"2026-01-08T17:33:45.329800272Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-xy9.4","title":"Setup Frontend with Vite and React","description":"Install Vite, React, Material-UI, React Router. Create index.html, main.tsx, App.tsx, and configure Vite with API proxy","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-08T17:33:46.428199818Z","updated_at":"2026-01-13T10:42:12.826939267Z","close_reason":"Closed","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-xy9.4","depends_on_id":"LandlordSoftware-xy9","type":"parent-child","created_at":"2026-01-08T17:33:46.441578667Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:42:12.826939267Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"LandlordSoftware-zcm","title":"Authentication Frontend","description":"Implement login page, auth context, and protected routes in React","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-08T17:33:23.389490772Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-zcm","depends_on_id":"LandlordSoftware-sx2","type":"blocks","created_at":"2026-01-08T19:14:09.036191182Z","created_by":"stuff"},{"issue_id":"LandlordSoftware-zcm","depends_on_id":"LandlordSoftware-xy9","type":"blocks","created_at":"2026-01-08T19:14:09.767142334Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"LandlordSoftware-zcm.1","title":"Create Login Page and Auth Context","description":"Create AuthContext for global auth state. Build Login page with Material-UI form. Implement authService. Add protected routes with React Router. Setup PrivateRoute component.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-08T17:34:29.136600639Z","updated_at":"2026-01-13T10:40:29.851152943Z","created_by":"stuff","dependencies":[{"issue_id":"LandlordSoftware-zcm.1","depends_on_id":"LandlordSoftware-zcm","type":"parent-child","created_at":"2026-01-08T17:34:29.148716275Z","created_by":"stuff"}],"deleted_at":"2026-01-13T10:40:29.851152943Z","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"Task-05w","title":"Phase 3: Core Transaction Logic","description":"Monzo API client, transaction processing, duplicate detection, and BankTransaction storage","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:25:59.002305872Z","updated_at":"2026-01-22T17:26:16.288356135Z","closed_at":"2026-01-22T17:26:16.288356135Z","close_reason":"All child tasks completed: Monzo API client, transaction processing pipeline, duplicate detection, and SyncLog management","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-05w","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:16.411552974Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-05w","depends_on_id":"Task-j3y","type":"blocks","created_at":"2026-01-20T18:31:12.73386143Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0b8","title":"Add role to auth endpoints and registration flow","description":"Modify server/src/routes/auth.ts to add role support:\n\n1. Update /register endpoint:\n   - Check user count using prisma.user.count()\n   - If count === 0, assign role: 'ADMIN' \n   - Otherwise, assign role: 'VIEWER'\n   - This ensures the first user is always an admin\n\n2. Update /me endpoint:\n   - Include role field in the response JSON\n   - Response should include: { id, email, name, role }\n\nComplete implementation:\n\n// In POST /register\nconst userCount = await prisma.user.count();\nconst role = userCount === 0 ? 'ADMIN' : 'VIEWER';\nconst user = await prisma.user.create({\n  data: {\n    email,\n    password: hashedPassword,\n    name,\n    role,\n  },\n});\n\n// In GET /me\nres.json({\n  id: req.user!.id,\n  email: req.user!.email,\n  name: req.user!.name,\n  role: req.user!.role,\n});\n\n3. Update tests in server/src/routes/__tests__/auth.test.ts:\n   - Test first user gets ADMIN role\n   - Test subsequent users get VIEWER role\n   - Test /me endpoint includes role in response\n   - Mock prisma.user.count() for test cases\n\nTest cases to add:\n- 'should assign ADMIN role to first user'\n- 'should assign VIEWER role to subsequent users'\n- 'should return user with role in /me endpoint'\n\nCommit message: feat: add role support to auth endpoints","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:58:44.032494287Z","updated_at":"2026-01-18T18:14:31.751937279Z","closed_at":"2026-01-18T18:14:31.751937279Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0b8","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:25.191090105Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0b8","depends_on_id":"Task-usd","type":"blocks","created_at":"2026-01-17T18:01:23.939843044Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0b8","depends_on_id":"Task-g0x","type":"blocks","created_at":"2026-01-17T18:01:24.555968704Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0dv","title":"Webhook registration with Monzo","description":"During OAuth flow, call POST /webhooks to register webhook with Monzo. Store webhookId and webhookUrl in BankAccount.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:30.899307941Z","updated_at":"2026-01-21T20:27:17.64682333Z","closed_at":"2026-01-21T20:27:17.64682333Z","close_reason":"Implemented webhook registration during OAuth flow with registerWebhook() and deleteWebhook() functions. Stores webhookId and webhookUrl in BankAccount. Graceful error handling ensures OAuth completes even if webhook operations fail. Added WEBHOOK_BASE_URL config. Both spec compliance and code quality reviews approved. All 43 tests passing. Note: Old webhook deletion may fail (expected - old tokens expired).","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0dv","depends_on_id":"Task-j3y","type":"parent-child","created_at":"2026-01-20T18:28:32.654589926Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0dv","depends_on_id":"Task-7im","type":"blocks","created_at":"2026-01-20T18:31:32.464953492Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0ge","title":"Integration tests for OAuth flow","description":"Test OAuth flow: initiate → callback → immediate history import → webhook registration → BankAccount creation. Test 5-minute window constraint.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:55.111473603Z","updated_at":"2026-01-20T18:27:55.111473603Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0ge","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:10.751411853Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0in","title":"Finances/Transactions page with transaction list, comprehensive filters (property/type/category/date range), add/edit transaction forms, file upload integration, and financial summary cards showing income vs expenses","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:19.945416416Z","updated_at":"2026-01-14T14:36:06.652603886Z","closed_at":"2026-01-14T14:36:06.652603886Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0in","depends_on_id":"Task-85a","type":"blocks","created_at":"2026-01-13T11:16:36.014528932Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0in","depends_on_id":"Task-4q5","type":"blocks","created_at":"2026-01-13T11:16:36.531509762Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0in","depends_on_id":"Task-ob7","type":"blocks","created_at":"2026-01-13T11:16:37.071228067Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0in","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:35.476590818Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0m9","title":"Shared Zod validation schemas for all entities","description":"Create comprehensive Zod validation schemas in shared/validation directory for:\n\nENTITIES:\n- Properties (name, address with UK postcode, property_type, purchase_date, purchase_price, status, notes)\n- Tenants (names, email, phone, emergency contacts, status)\n- Leases (property_id, tenant_id, dates, monthly_rent, security_deposit, status)\n- Transactions (property_id, lease_id, type, category, amount, date, description)\n- Events (property_id, event_type, title, description, scheduled_date, completed)\n\nVALIDATIONS:\n- UK postcode: AA9A 9AA, A9A 9AA, A9 9AA, A99 9AA, AA9 9AA, AA99 9AA formats\n- Email: standard email format\n- Phone: UK phone formats (mobile/landline)\n- Date ranges: start_date \u003c= end_date for leases\n- Positive decimals: financial amounts (rent, deposit, transaction amount)\n- Enums: property_type, status fields, transaction types, event types\n- File validation: MIME types (jpg, png, pdf), 10MB size limit\n\nUSAGE:\n- Export schemas for backend API validation (Express middleware)\n- Export schemas for frontend React Hook Form with Zod resolver\n- Shared between client and server for consistent validation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:48:57.68635739Z","updated_at":"2026-01-13T13:01:36.587101664Z","closed_at":"2026-01-13T13:01:36.587101664Z","close_reason":"Zod validation schemas complete for all entities. All format validations, enums, and business logic implemented correctly. Includes tests and documentation. Code quality: 8.5/10 - Approved. Suggested future improvements: refactor duplicate refinement logic, add Update schema tests.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0m9","depends_on_id":"Task-tmr","type":"blocks","created_at":"2026-01-13T11:15:09.95192613Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-0ur","title":"Events/Calendar CRUD API with filtering, completion status tracking, and event type categorization","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:47:38.748733504Z","updated_at":"2026-01-13T14:34:42.78993167Z","closed_at":"2026-01-13T14:34:42.78993167Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-0ur","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:15:54.934722829Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0ur","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:53.398794063Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0ur","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:53.925002036Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-0ur","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:54.428366111Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-112","title":"Manual sync trigger endpoint","description":"Implement POST /api/bank/accounts/:id/sync for manual transaction sync with admin authentication","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:19.576839866Z","updated_at":"2026-01-21T17:46:56.313548877Z","closed_at":"2026-01-21T17:46:56.313548877Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-112","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:26.779405663Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-18u","title":"Implement Leases Page","description":"## Overview\nReplace the placeholder Leases page with a full CRUD implementation following the existing patterns in Properties and Tenants pages.\n\n## Files to Modify\n- `client/src/pages/Leases.tsx` - Complete rewrite\n\n## Implementation Steps\n\n### Step 1: Set up the page structure\nReplace the placeholder with full implementation following Properties.tsx pattern:\n- Import statements for MUI components, services, types\n- State for leases list, loading, error\n- State for filters: propertyFilter, statusFilter, searchQuery\n- State for dialog: dialogOpen, dialogMode, selectedLease, formData\n- State for delete: deleteDialogOpen, leaseToDelete\n\n### Step 2: Add fetch function\n```typescript\nconst fetchLeases = async () =\u003e {\n  try {\n    setLoading(true);\n    setError(null);\n    const filters: LeaseFilters = {};\n    if (propertyFilter !== 'all') filters.propertyId = propertyFilter;\n    if (statusFilter !== 'all') filters.status = statusFilter as LeaseStatus;\n    const fetchedLeases = await leasesService.getLeases(filters);\n    setLeases(fetchedLeases);\n  } catch (err) {\n    const errorMessage = err instanceof ApiError ? err.message : 'Failed to load leases';\n    setError(errorMessage);\n    toast.error(errorMessage);\n  } finally {\n    setLoading(false);\n  }\n};\n```\n\n### Step 3: Add filter UI\n- Property dropdown (fetch properties for options)\n- Status dropdown: Draft, Active, Expired, Terminated\n- Search input for tenant name (client-side filter)\n\n### Step 4: Add lease list/cards\nDisplay each lease as a card or table row showing:\n- Property name (from lease.property)\n- Tenant name (from lease.tenant)\n- Monthly rent formatted as £X,XXX/month\n- Date range (startDate - endDate or \"Ongoing\")\n- Status badge with color coding\n\n### Step 5: Add Create/Edit dialog\nForm fields:\n- Property select (required, fetch from properties API)\n- Tenant select (required, fetch from tenants API)\n- Start date (required, date picker)\n- End date (optional, date picker)\n- Monthly rent (required, number input with £ prefix)\n- Security deposit amount (required, number input)\n- Security deposit paid date (optional, date picker)\n- Status select (Draft, Active, Expired, Terminated)\n\n### Step 6: Add CRUD handlers\n- handleOpenDialog(mode, lease?)\n- handleCloseDialog()\n- handleSubmit() - create or update via leasesService\n- handleDeleteClick(lease)\n- handleDeleteConfirm() - delete via leasesService\n\n### Step 7: Add delete confirmation dialog\nUse existing ConfirmDialog component\n\n### Step 8: Verify\nRun: `npm run dev`\n- Navigate to Leases page\n- Create a new lease\n- Edit an existing lease\n- Delete a lease\n- Filter by property and status\n\n### Step 9: Commit\n```bash\ngit add client/src/pages/Leases.tsx\ngit commit -m \"feat: implement full CRUD Leases page\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:24:37.219545213Z","updated_at":"2026-01-15T18:30:58.714951652Z","closed_at":"2026-01-15T18:30:58.714951652Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-18u","depends_on_id":"Task-860","type":"blocks","created_at":"2026-01-15T17:25:04.493524563Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-1is","title":"Error handling and retry logic","description":"Implement retry logic for manual sync: network errors (3x exponential backoff), rate limiting (429 with Retry-After), token refresh on 401, logging and status tracking","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:36.025076605Z","updated_at":"2026-01-24T18:24:55.049770414Z","closed_at":"2026-01-24T18:24:55.049770414Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-1is","depends_on_id":"Task-hkn","type":"parent-child","created_at":"2026-01-20T18:29:02.603944828Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-1kj","title":"Add role-based conditional rendering to Properties page","description":"Modify client/src/pages/Properties.tsx to use canWrite() from AuthContext to conditionally show Add/Edit/Delete buttons. Hide forms and editing capabilities for viewer role users. Ensure all action buttons respect role permissions. Complete implementation and commit with message: 'feat: add role-based UI to Properties page'","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:59:52.829119595Z","updated_at":"2026-01-22T20:16:07.059792835Z","closed_at":"2026-01-22T20:16:07.059792835Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-1kj","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:48.662718983Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-1ks","title":"Frontend API client service using Axios with interceptors and typed methods for all endpoints","description":"Create a comprehensive Axios-based API client service for the frontend with the following features:\n\nDEPENDENCIES INSTALLATION:\nRun in client/ directory first:\nnpm install axios zod\n\nCORE SETUP:\n- Configure Axios instance with base URL (/api), timeout settings (10000ms)\n- Request/response interceptors for authentication (include credentials, handle session)\n- Error handling interceptor (handle 401, 403, 404, 500 errors with standardized error format)\n- Request/response logging in development mode (check import.meta.env.DEV)\n- Retry logic for failed requests (retry once on 5xx errors)\n- Export singleton API client instance\n\nTYPESCRIPT INTERFACES:\n- Complete TypeScript interfaces for all request payloads\n- Complete TypeScript interfaces for all API responses\n- Error response types matching backend format: { success: false, error: string | { code: string, message: string, details?: any } }\n- Query parameter types for filtering\n- Import Zod schemas from shared/validation for runtime validation if needed\n\nAPI MODULES (typed methods):\n\nAUTH:\n- login(email, password) -\u003e User session\n- logout() -\u003e void\n- getMe() -\u003e Current user\n\nPROPERTIES:\n- getProperties(filters?: {status?, propertyType?, search?}) -\u003e Property[]\n- getProperty(id) -\u003e Property with details\n- createProperty(data) -\u003e Property\n- updateProperty(id, data) -\u003e Property\n- deleteProperty(id) -\u003e void\n\nTENANTS:\n- getTenants(filters?: {status?: 'Prospective' | 'Active' | 'Former', search?}) -\u003e Tenant[]\n- getTenant(id) -\u003e Tenant with lease history\n- getTenantLeaseHistory(id, filters?: {fromDate?, toDate?}) -\u003e Lease[] with property details\n- createTenant(data) -\u003e Tenant\n- updateTenant(id, data) -\u003e Tenant\n- deleteTenant(id) -\u003e void\n\nLEASES:\n- getLeases(filters?: {property_id?, tenant_id?, status?}) -\u003e Lease[]\n- getLease(id) -\u003e Lease details with property and tenant\n- createLease(data) -\u003e Lease\n- updateLease(id, data) -\u003e Lease\n- deleteLease(id) -\u003e void\n\nTRANSACTIONS:\n- getTransactions(filters?: {property_id?, type?, category?, start_date?, end_date?}) -\u003e Transaction[]\n- getTransaction(id) -\u003e Transaction with documents\n- createTransaction(data) -\u003e Transaction\n- updateTransaction(id, data) -\u003e Transaction\n- deleteTransaction(id) -\u003e void\n- getTransactionSummary(filters?: {property_id?, start_date?, end_date?}) -\u003e Financial summary\n\nEVENTS:\n- getEvents(filters?: {property_id?, completed?, start_date?, end_date?}) -\u003e Event[]\n- getEvent(id) -\u003e Event details\n- createEvent(data) -\u003e Event\n- updateEvent(id, data) -\u003e Event\n- deleteEvent(id) -\u003e void\n- markEventComplete(id) -\u003e Event\n\nDOCUMENTS:\n- uploadDocument(file: File, entity_type, entity_id) -\u003e Document (multipart/form-data)\n- downloadDocument(id) -\u003e Blob\n- deleteDocument(id) -\u003e void\n\nIMPLEMENTATION DETAILS:\n- Create client/src/services/api.ts for main API client configuration\n- Create client/src/services/api/ directory for module-specific services:\n  * auth.service.ts\n  * properties.service.ts\n  * tenants.service.ts\n  * leases.service.ts\n  * transactions.service.ts\n  * events.service.ts\n  * documents.service.ts\n- Create client/src/types/api.types.ts for API response/request types\n- Proper error handling with typed errors (create ApiError class)\n- Success/error response wrapping matching backend format: { success: boolean, data?: any, error?: string }\n- Development vs production configuration (use import.meta.env)\n- All methods should handle loading states and errors gracefully\n- Use axios interceptors to automatically include credentials: 'include'\n- Handle 401 errors by redirecting to login (or emit event for auth context)\n\nERROR HANDLING:\n- Create custom ApiError class with status, message, and details\n- Transform axios errors to ApiError instances\n- Provide user-friendly error messages\n- Log errors in development mode\n\nTESTING:\n- Test successful API calls\n- Test error handling (network errors, 4xx, 5xx)\n- Test authentication interceptor\n- Test retry logic\n\nDEPENDS ON\n  → ✓ Task-0m9: Shared Zod validation schemas for all entities ● P1\n  → ✓ Task-atm: React frontend foundation with React Router setup, Material-UI theme configuration, authentication context, and main layout component with navigation ● P1\n\nBLOCKS\n  ← ○ Task-0in: Finances/Transactions page with transaction list, comprehensive filters (property/type/category/date range), add/edit transaction forms, file upload integration, and financial summary cards showing income vs expenses ● P2\n  ← ○ Task-6lt: Implement Tenants Page with Tabs and CRUD Operations ● P2\n  ← ○ Task-7xg: Create Dashboard page with Material-UI overview cards, events widget, transactions list, and quick actions ● P2\n  ← ○ Task-mdy: Calendar/Events Page with react-big-calendar ● P2\n  ← ○ Task-pmy: Properties List/Detail Page with CRUD Operations ● P2\n  ← ○ Task-vpz: Global error handling with React error boundary, toast notifications using Material-UI Snackbar, loading states, and standardized error response handling in API client ● P2","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:49:13.70922805Z","updated_at":"2026-01-13T21:18:33.155554107Z","closed_at":"2026-01-13T21:18:33.155554107Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-1ks","depends_on_id":"Task-atm","type":"blocks","created_at":"2026-01-13T11:16:11.103538757Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1ks","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:16:11.655494957Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-1t8","title":"Production Build Configuration","description":"Configure production build setup including building both client and server, serving static files from Express, environment variable configuration, and build scripts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T10:48:20.327371119Z","updated_at":"2026-01-14T19:01:33.302819311Z","closed_at":"2026-01-14T19:01:33.302819311Z","close_reason":"Completed production build configuration with static file serving, compression, environment variables, and build orchestration. Passed spec compliance and code quality reviews.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-1t8","depends_on_id":"Task-6lt","type":"blocks","created_at":"2026-01-13T11:16:55.467138594Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1t8","depends_on_id":"Task-0in","type":"blocks","created_at":"2026-01-13T11:16:56.004026939Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1t8","depends_on_id":"Task-mdy","type":"blocks","created_at":"2026-01-13T11:16:56.530883666Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1t8","depends_on_id":"Task-bhk","type":"blocks","created_at":"2026-01-13T11:16:57.056690214Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1t8","depends_on_id":"Task-7xg","type":"blocks","created_at":"2026-01-13T11:16:54.460193081Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1t8","depends_on_id":"Task-pmy","type":"blocks","created_at":"2026-01-13T11:16:54.945149061Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-1uo","title":"Transaction/PendingTransaction creation logic","description":"After rule matching, create Transaction if fully matched (all 3 fields) or PendingTransaction if partial/unmatched. Validate property exists and type/category match.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:03.215078603Z","updated_at":"2026-01-22T18:11:21.923210953Z","closed_at":"2026-01-22T18:11:21.923210953Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-1uo","depends_on_id":"Task-hfb","type":"parent-child","created_at":"2026-01-20T18:28:48.139206896Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-1uo","depends_on_id":"Task-lt9","type":"blocks","created_at":"2026-01-20T18:31:46.187792679Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-221","title":"Prisma schema \u0026 database setup","description":"## Overview\nSet up Prisma ORM with SQLite database, define all schemas (Properties, Tenants, Leases, Transactions, Events, Documents, Users), and run initial migration.\n\n## Files\n- Create: `prisma/schema.prisma`\n- Create: `server/src/db/client.ts`\n\n## Implementation Steps\n\n### Step 1: Create Prisma schema\n\n`prisma/schema.prisma`:\n```prisma\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\ndatasource db {\n  provider = \"sqlite\"\n  url      = env(\"DATABASE_URL\")\n}\n\nmodel User {\n  id        String   @id @default(uuid())\n  email     String   @unique\n  password  String\n  createdAt DateTime @default(now()) @map(\"created_at\")\n  updatedAt DateTime @updatedAt @map(\"updated_at\")\n\n  @@map(\"users\")\n}\n\nmodel Property {\n  id            String   @id @default(uuid())\n  name          String\n  street        String\n  city          String\n  county        String\n  postcode      String\n  propertyType  String   @map(\"property_type\")\n  purchaseDate  DateTime? @map(\"purchase_date\")\n  purchasePrice Float?    @map(\"purchase_price\")\n  status        String\n  notes         String?\n  createdAt     DateTime @default(now()) @map(\"created_at\")\n  updatedAt     DateTime @updatedAt @map(\"updated_at\")\n\n  leases       Lease[]\n  transactions Transaction[]\n  events       Event[]\n  documents    Document[]\n\n  @@map(\"properties\")\n}\n\nmodel Tenant {\n  id                    String   @id @default(uuid())\n  firstName             String   @map(\"first_name\")\n  lastName              String   @map(\"last_name\")\n  email                 String\n  phone                 String\n  emergencyContactName  String?  @map(\"emergency_contact_name\")\n  emergencyContactPhone String?  @map(\"emergency_contact_phone\")\n  status                String\n  notes                 String?\n  createdAt             DateTime @default(now()) @map(\"created_at\")\n  updatedAt             DateTime @updatedAt @map(\"updated_at\")\n\n  leases    Lease[]\n  documents Document[]\n\n  @@map(\"tenants\")\n}\n\nmodel Lease {\n  id                      String    @id @default(uuid())\n  propertyId              String    @map(\"property_id\")\n  tenantId                String    @map(\"tenant_id\")\n  startDate               DateTime  @map(\"start_date\")\n  endDate                 DateTime? @map(\"end_date\")\n  monthlyRent             Float     @map(\"monthly_rent\")\n  securityDepositAmount   Float     @map(\"security_deposit_amount\")\n  securityDepositPaidDate DateTime? @map(\"security_deposit_paid_date\")\n  status                  String\n  createdAt               DateTime  @default(now()) @map(\"created_at\")\n  updatedAt               DateTime  @updatedAt @map(\"updated_at\")\n\n  property     Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)\n  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)\n  transactions Transaction[]\n\n  @@map(\"leases\")\n}\n\nmodel Transaction {\n  id              String   @id @default(uuid())\n  propertyId      String   @map(\"property_id\")\n  leaseId         String?  @map(\"lease_id\")\n  type            String\n  category        String\n  amount          Float\n  transactionDate DateTime @map(\"transaction_date\")\n  description     String\n  createdAt       DateTime @default(now()) @map(\"created_at\")\n  updatedAt       DateTime @updatedAt @map(\"updated_at\")\n\n  property  Property   @relation(fields: [propertyId], references: [id], onDelete: Cascade)\n  lease     Lease?     @relation(fields: [leaseId], references: [id], onDelete: SetNull)\n  documents Document[]\n\n  @@map(\"transactions\")\n}\n\nmodel Event {\n  id            String    @id @default(uuid())\n  propertyId    String    @map(\"property_id\")\n  eventType     String    @map(\"event_type\")\n  title         String\n  description   String?\n  scheduledDate DateTime  @map(\"scheduled_date\")\n  completed     Boolean   @default(false)\n  completedDate DateTime? @map(\"completed_date\")\n  createdAt     DateTime  @default(now()) @map(\"created_at\")\n  updatedAt     DateTime  @updatedAt @map(\"updated_at\")\n\n  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)\n\n  @@map(\"events\")\n}\n\nmodel Document {\n  id         String   @id @default(uuid())\n  entityType String   @map(\"entity_type\")\n  entityId   String   @map(\"entity_id\")\n  fileName   String   @map(\"file_name\")\n  filePath   String   @map(\"file_path\")\n  fileType   String   @map(\"file_type\")\n  fileSize   Int      @map(\"file_size\")\n  uploadedAt DateTime @default(now()) @map(\"uploaded_at\")\n\n  property    Property?    @relation(fields: [entityId], references: [id], onDelete: Cascade)\n  tenant      Tenant?      @relation(fields: [entityId], references: [id], onDelete: Cascade)\n  transaction Transaction? @relation(fields: [entityId], references: [id], onDelete: Cascade)\n\n  @@map(\"documents\")\n}\n```\n\n### Step 2: Create database client\n\n`server/src/db/client.ts`:\n```typescript\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient({\n  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n});\n\nexport default prisma;\n```\n\n### Step 3: Generate Prisma client\n\n```bash\nnpx prisma generate\n```\n\nExpected: Prisma client generated successfully\n\n### Step 4: Run initial migration\n\n```bash\nmkdir -p data\nnpx prisma migrate dev --name initial_schema\n```\n\nExpected: Migration created and applied, database file created at `data/landlord.db`\n\n### Step 5: Verify schema\n\n```bash\nnpx prisma studio\n```\n\nExpected: Prisma Studio opens at http://localhost:5555 showing all tables\n\n### Step 6: Test database connection\n\nCreate `server/src/test-db.ts`:\n```typescript\nimport prisma from './db/client';\n\nasync function testConnection() {\n  try {\n    await prisma.$connect();\n    console.log('✅ Database connected successfully');\n    \n    const userCount = await prisma.user.count();\n    console.log(`Users in database: ${userCount}`);\n    \n    await prisma.$disconnect();\n  } catch (error) {\n    console.error('❌ Database connection failed:', error);\n    process.exit(1);\n  }\n}\n\ntestConnection();\n```\n\nRun:\n```bash\ntsx server/src/test-db.ts\n```\n\nExpected: \"✅ Database connected successfully\" and \"Users in database: 0\"\n\n### Step 7: Clean up test file\n\n```bash\nrm server/src/test-db.ts\n```\n\n### Step 8: Commit\n\n```bash\ngit add prisma/ server/src/db/ data/.gitkeep\ngit commit -m \"feat: add Prisma schema and database setup\"\n```\n\n## Verification\n\n- [ ] `data/landlord.db` file exists\n- [ ] `npx prisma studio` opens without errors\n- [ ] All 7 tables visible in Prisma Studio: users, properties, tenants, leases, transactions, events, documents\n- [ ] Prisma client imports successfully in TypeScript\n- [ ] Foreign key relationships are correct\n\n## Notes\n\n- SQLite is used for simplicity and portability\n- All IDs use UUID for better scalability\n- Cascade deletes are configured for data integrity\n- Snake_case for database columns, camelCase for TypeScript\n- Dates are stored as DateTime in SQLite (ISO 8601 strings)","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-13T10:47:34.611465194Z","updated_at":"2026-01-13T12:46:10.218771116Z","closed_at":"2026-01-13T12:46:10.218771116Z","close_reason":"Prisma schema and database setup complete. All 7 models created with proper relationships. Migration applied successfully. Code quality: 8.5/10 - Approved with recommendations for future enhancements (add enums for type safety, verify Document index).","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-221","depends_on_id":"Task-tmr","type":"blocks","created_at":"2026-01-13T11:15:09.475559536Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-22x","title":"Database schema and migrations","description":"Create Prisma schema for BankAccount, BankTransaction, MatchingRule, PendingTransaction, SyncLog, TransactionAuditLog, and update Transaction model with bank integration fields. Generate and run migrations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:15.346607419Z","updated_at":"2026-01-20T20:17:56.399389031Z","closed_at":"2026-01-20T20:17:56.399389031Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-22x","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:23.81429397Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-2bt","title":"Pending review interface","description":"Create /admin/pending-transactions page with filterable table, inline editing for propertyId/type/category, and PendingCountBadge in navigation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:23.563011308Z","updated_at":"2026-01-24T14:13:38.758605504Z","closed_at":"2026-01-24T14:13:38.758605504Z","close_reason":"Pending review interface complete - all tests passing, spec compliant with excellent code quality","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-2bt","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:57.432151955Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-2bt","depends_on_id":"Task-n4r","type":"blocks","created_at":"2026-01-20T18:31:56.755520792Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-2ih","title":"Transaction processing pipeline","description":"Implement unified transaction processing for both webhook payloads and manual sync API responses. Process single or multiple transactions through same pipeline.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:45.868948665Z","updated_at":"2026-01-22T17:14:03.922581921Z","closed_at":"2026-01-22T17:14:03.922581921Z","close_reason":"Implemented unified transaction processing pipeline with full integration across webhook and sync endpoints","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-2ih","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:39.127176711Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-2ih","depends_on_id":"Task-gnp","type":"blocks","created_at":"2026-01-20T18:31:39.242322212Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-3l0","title":"User documentation","description":"Write user-facing documentation: connecting bank account, configuring matching rules, reviewing pending transactions, understanding imported vs manual transactions","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:57.76235879Z","updated_at":"2026-01-20T18:27:57.76235879Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-3l0","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:12.503474044Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-3vl","title":"Add 403 Forbidden error handling to API service","description":"## Overview\nAdd global error handling for 403 Forbidden responses to provide user feedback when permission is denied.\n\n## Implementation\n\n### Modify client/src/services/api.ts\n\n1. Import toast context/service for notifications\n\n2. Add response interceptor to catch 403 errors:\n```typescript\napiClient.interceptors.response.use(\n  (response) =\u003e response,\n  (error) =\u003e {\n    if (error.response?.status === 403) {\n      // Show toast notification\n      toast.error(\"You don't have permission to perform this action\");\n    }\n    return Promise.reject(error);\n  }\n);\n```\n\n3. Ensure the interceptor is registered when the API client is initialized\n\n## Complete Implementation Example\n\n```typescript\nimport axios from 'axios';\nimport { toast } from '../contexts/ToastContext'; // or wherever toast is exported\n\nconst apiClient = axios.create({\n  baseURL: '/api',\n  withCredentials: true,\n});\n\napiClient.interceptors.response.use(\n  (response) =\u003e response,\n  (error) =\u003e {\n    if (error.response?.status === 403) {\n      toast.error(\"You don't have permission to perform this action\");\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default apiClient;\n```\n\n## Verification\n\n- Trigger a 403 error (e.g., tenant trying to create a property)\n- Verify toast notification appears with the permission message\n- Check that the error still propagates for component-level handling\n- Test with multiple 403 errors to ensure notifications work correctly\n\n## Commit Message\n```\nfeat: add 403 error handling with toast notifications\n\nAdd response interceptor to API client to catch 403 Forbidden errors\nand display user-friendly toast notification.\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:00:39.913090623Z","updated_at":"2026-01-17T23:19:50.132624743Z","closed_at":"2026-01-17T23:19:50.132624743Z","close_reason":"Spec was incomplete - required ToastContext singleton pattern to enable toast usage in Axios interceptor (non-React code). Implementation is correct and follows best practices.","created_by":"Alexander Pezarro"}
{"id":"Task-3zz","title":"API endpoint tests (100% coverage)","description":"Test all API endpoints: CRUD operations, validation rules, error scenarios, bulk operations, authentication/authorization. Achieve 100% endpoint coverage.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:55.967168994Z","updated_at":"2026-01-20T18:27:55.967168994Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-3zz","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:11.340116591Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-3zz","depends_on_id":"Task-6a9","type":"blocks","created_at":"2026-01-20T18:32:07.165202069Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-3zz","depends_on_id":"Task-tn1","type":"blocks","created_at":"2026-01-20T18:32:07.882874899Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-3zz","depends_on_id":"Task-0ge","type":"blocks","created_at":"2026-01-20T18:32:08.624753777Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-4fz","title":"Storage service interface with local filesystem implementation","description":"## Overview\nCreate a storage service interface with a local filesystem implementation for handling document uploads. This includes defining the interface contract, implementing local storage, adding proper error handling, and comprehensive testing.\n\n## Files to Create\n1. `server/src/services/storage/IStorageService.ts` - Storage interface\n2. `server/src/services/storage/LocalStorageService.ts` - Local implementation\n3. `server/src/services/storage/index.ts` - Export barrel file\n4. `server/src/config/storage.ts` - Storage configuration\n5. `server/src/services/storage/errors.ts` - Error classes\n6. `server/src/__tests__/services/storage/LocalStorageService.test.ts` - Test file\n\n## TDD Implementation Steps\n\n### Step 1: Write failing tests with test file structure\n\n### Step 2: Create storage configuration with max file size and allowed MIME types\n\n### Step 3: Create storage interface and error types (StorageError, FileSizeError, InvalidFileTypeError, PathTraversalError)\n\n### Step 4: Implement LocalStorageService with validation\n\n### Step 5: Run tests (should pass)\n\n### Step 6: Add static file serving to Express\n\n## Verification Checklist\n- [ ] All unit tests pass\n- [ ] File size validation works\n- [ ] MIME type validation works\n- [ ] Path traversal protection works\n- [ ] Unique filenames generated\n- [ ] Files organized by year/month\n- [ ] Test coverage \u003e80%\n\n## Security Features\n- File size limits prevent DoS\n- MIME type validation prevents malicious uploads\n- Path traversal validation prevents directory escape\n- Unique filenames prevent collisions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T11:14:24.860373558Z","updated_at":"2026-01-13T13:13:33.875028852Z","closed_at":"2026-01-13T13:13:33.875028852Z","close_reason":"Storage service implementation complete with TDD approach. 98.11% test coverage, all security features implemented. Code quality: 8.5/10 - Approved. Production-ready. Suggested future improvements: refine error handling in ensureDirectory, add constructor validation, fix hardcoded path in server.ts.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-4fz","depends_on_id":"Task-tmr","type":"blocks","created_at":"2026-01-13T11:15:10.460805016Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-4l5","title":"Properties CRUD API with all endpoints, Zod validation, error handling, and tests","description":"Implement comprehensive Properties CRUD API with the following requirements:\n\n## Endpoints\n- GET /api/properties - List all properties with filtering by status (active/inactive), type (single-family/multi-family/apartment/commercial), and optional search\n- GET /api/properties/:id - Get single property by ID with full details\n- POST /api/properties - Create new property with validation\n- PUT /api/properties/:id - Update existing property\n- DELETE /api/properties/:id - Soft delete property (mark as inactive)\n\n## Data Model\nProperty fields should include:\n- id (UUID/Auto-generated)\n- address (street, city, state, zip)\n- type (enum: single-family, multi-family, apartment, commercial)\n- status (enum: active, inactive, under-renovation)\n- purchase_date\n- purchase_price\n- current_value\n- bedrooms\n- bathrooms\n- square_feet\n- description\n- notes\n- created_at\n- updated_at\n\n## Validation\n- Implement Zod schemas for:\n  - Property creation (all required fields)\n  - Property update (partial fields allowed)\n  - Query parameters for filtering\n- Validate address format and required components\n- Validate numeric fields (price \u003e 0, bedrooms \u003e= 0, etc.)\n- Validate enums for type and status\n\n## Error Handling\n- Return appropriate HTTP status codes (200, 201, 400, 404, 500)\n- Consistent error response format with message and validation details\n- Handle database errors gracefully\n- Validate UUID format for ID parameters\n\n## Testing Steps\n1. Test GET /api/properties returns empty array initially\n2. Test POST /api/properties creates property with valid data\n3. Test POST validation errors for invalid/missing fields\n4. Test GET /api/properties/:id returns created property\n5. Test GET /api/properties/:id returns 404 for non-existent ID\n6. Test PUT /api/properties/:id updates property fields\n7. Test DELETE /api/properties/:id soft deletes property\n8. Test GET /api/properties with filters (status, type)\n9. Test edge cases (duplicate addresses, invalid enums, SQL injection attempts)\n\n## Implementation Notes\n- Use Express.js router pattern\n- Follow RESTful conventions\n- Include proper TypeScript types\n- Use async/await with try-catch blocks\n- Log errors appropriately\n- Return consistent JSON response structure","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:48:00.976725875Z","updated_at":"2026-01-13T14:11:15.522889141Z","closed_at":"2026-01-13T14:11:15.522889141Z","close_reason":"Properties CRUD API implemented with comprehensive Zod validation, authentication, 44 passing tests covering all endpoints, filtering, search, and edge cases. Spec compliant and code quality approved.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-4l5","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:45.424280233Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4l5","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:45.90139583Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4l5","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:46.399482916Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-4q5","title":"Implement Transactions CRUD API with filtering, financial summary, and validation","description":"Create REST API endpoints for transaction management:\n- CRUD operations (Create, Read, Update, Delete) for transactions\n- Filtering capabilities: by property ID, transaction type, category, and date range\n- Financial summary endpoint: aggregated transaction data and reporting\n- Input validation: ensure data integrity for all transaction operations\n- Proper error handling and response formatting\n- Integration with existing database schema for transactions table","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:47:40.499254079Z","updated_at":"2026-01-13T18:15:59.636513135Z","closed_at":"2026-01-13T18:15:59.636513135Z","close_reason":"Implemented Transactions CRUD API with filtering, financial summary (optimized with database aggregation), comprehensive validation, and 52 passing tests. Performance optimized for large datasets.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-4q5","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:51.366517563Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4q5","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:51.851352104Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4q5","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:15:52.361049777Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4q5","depends_on_id":"Task-srp","type":"blocks","created_at":"2026-01-13T11:15:52.853894864Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-4q5","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:50.871294103Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-54r","title":"Idempotency handling for webhooks","description":"Track webhook event IDs to prevent duplicate processing. Store webhookEventId in SyncLog for deduplication.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:32.539766319Z","updated_at":"2026-01-21T20:38:30.005431068Z","closed_at":"2026-01-21T20:38:30.005431068Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-54r","depends_on_id":"Task-j3y","type":"parent-child","created_at":"2026-01-20T18:28:33.857100568Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-54r","depends_on_id":"Task-s6w","type":"blocks","created_at":"2026-01-20T18:31:33.718321708Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-5eh","title":"Rule reprocessing on changes","description":"When rules are created/updated/deleted, automatically reprocess all PendingTransactions. If newly matched, auto-approve and create Transaction.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:04.844684346Z","updated_at":"2026-01-22T19:56:14.762184771Z","closed_at":"2026-01-22T19:56:14.762184771Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-5eh","depends_on_id":"Task-6nh","type":"blocks","created_at":"2026-01-20T18:31:47.453875969Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-5eh","depends_on_id":"Task-ce7","type":"blocks","created_at":"2026-01-20T18:31:48.094561079Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-5eh","depends_on_id":"Task-hfb","type":"parent-child","created_at":"2026-01-20T18:28:49.379393085Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6a9","title":"Unit tests for rule matching logic","description":"Write comprehensive unit tests for rule matching: AND/OR operators, pattern matching types (contains, equals, startsWith, endsWith, comparisons), field accumulation, priority ordering. Target 90%+ coverage.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:53.436595105Z","updated_at":"2026-01-20T18:27:53.436595105Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6a9","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:09.582440449Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6fr","title":"Create database seeding script with sample properties, tenants, leases, transactions, and events for testing and demonstration. Include script to reset/seed database with realistic test data.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T10:48:45.250585324Z","updated_at":"2026-01-14T12:48:43.751401884Z","closed_at":"2026-01-14T12:48:43.751401884Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6fr","depends_on_id":"Task-srp","type":"blocks","created_at":"2026-01-13T11:16:52.92334536Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6fr","depends_on_id":"Task-4q5","type":"blocks","created_at":"2026-01-13T11:16:53.436408314Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6fr","depends_on_id":"Task-0ur","type":"blocks","created_at":"2026-01-13T11:16:53.92516449Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6fr","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:16:51.351200271Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6fr","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:16:51.86450921Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6fr","depends_on_id":"Task-d3h","type":"blocks","created_at":"2026-01-13T11:16:52.400706436Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6gi","title":"Phase 1: Foundation","description":"Core infrastructure including database schema, token encryption, OAuth flow with immediate history import, and basic CRUD operations","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:25:57.305690172Z","updated_at":"2026-01-21T17:46:56.317744549Z","closed_at":"2026-01-21T17:46:56.317744549Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6gi","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:15.26590597Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6lt","title":"Implement Tenants Page with Tabs and CRUD Operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:01.287491141Z","updated_at":"2026-01-14T14:09:39.23777146Z","closed_at":"2026-01-14T14:09:39.23777146Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6lt","depends_on_id":"Task-srp","type":"blocks","created_at":"2026-01-13T11:16:34.320996749Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6lt","depends_on_id":"Task-ob7","type":"blocks","created_at":"2026-01-13T11:16:34.935501874Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6lt","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:32.72475405Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6lt","depends_on_id":"Task-85a","type":"blocks","created_at":"2026-01-13T11:16:33.228188664Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6lt","depends_on_id":"Task-d3h","type":"blocks","created_at":"2026-01-13T11:16:33.770603139Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6nh","title":"MatchingRule CRUD endpoints","description":"Implement GET/POST/PUT/DELETE endpoints for matching rules: /api/bank/accounts/:accountId/rules, /api/bank/rules/:id, /api/bank/rules/reorder, /api/bank/rules/:id/test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:01.574709787Z","updated_at":"2026-01-22T19:23:10.715235413Z","closed_at":"2026-01-22T19:23:10.715235413Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6nh","depends_on_id":"Task-1uo","type":"blocks","created_at":"2026-01-20T18:31:46.774647024Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6nh","depends_on_id":"Task-hfb","type":"parent-child","created_at":"2026-01-20T18:28:46.950739343Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-6s3","title":"Frontend: Optimize Properties page with batch lease fetching","description":"## Overview\n\nRefactor the Properties page to fetch all active leases in a single batched API call instead of N+1 individual calls, then match them to properties client-side.\n\n## Files\n\n- Modify: `client/src/pages/Properties.tsx` (fetchProperties function, lines 98-140)\n\n## Implementation Steps\n\n### Step 1: Review current N+1 pattern\n\nRead lines 102-140 in `client/src/pages/Properties.tsx`.\n\nCurrent code fetches properties, then loops to fetch leases:\n```typescript\nconst fetchedProperties = await propertiesService.getProperties();\nconst propertiesWithLeases = await Promise.all(\n  fetchedProperties.map(async (property) =\u003e {\n    const leases = await leasesService.getLeases({\n      propertyId: property.id,\n      status: 'Active',\n    });\n    // ...\n  })\n);\n```\n\n### Step 2: Replace with optimized batch fetching\n\nReplace the fetchProperties function with this optimized version:\n\n```typescript\nconst fetchProperties = async () =\u003e {\n  try {\n    setLoading(true);\n    setError(null);\n\n    // Fetch all properties\n    const fetchedProperties = await propertiesService.getProperties();\n\n    // If no properties, no need to fetch leases\n    if (fetchedProperties.length === 0) {\n      setProperties([]);\n      return;\n    }\n\n    // Batch fetch all active leases for all properties in ONE call\n    const propertyIds = fetchedProperties.map(p =\u003e p.id);\n    const allLeases = await leasesService.getLeases({\n      propertyId: propertyIds,\n      status: 'Active',\n    });\n\n    // Match leases to properties client-side\n    const propertiesWithLeases = fetchedProperties.map(property =\u003e {\n      const activeLease = allLeases.find(\n        lease =\u003e lease.propertyId === property.id \u0026\u0026 lease.status === 'Active'\n      );\n      return {\n        ...property,\n        activeLease: activeLease || null,\n      };\n    });\n\n    setProperties(propertiesWithLeases);\n  } catch (err) {\n    console.error('Error fetching properties:', err);\n    const errorMessage = err instanceof ApiError ? err.message : 'Failed to load properties';\n    setError(errorMessage);\n    toast.error(errorMessage);\n  } finally {\n    setLoading(false);\n  }\n};\n```\n\n### Step 3: Test the optimization\n\nStart the development server:\n```bash\nnpm run dev\n```\n\nNavigate to the Properties page and open browser DevTools Network tab.\n\nExpected:\n- Only 2 API calls total (not N+1):\n  1. GET /api/properties\n  2. GET /api/leases?property_id=id1\u0026property_id=id2\u0026...\u0026status=Active\n- All properties display correctly with their active leases\n- No change in UI or functionality\n\n### Step 4: Test with different scenarios\n\nTest these cases:\n1. Properties with no active leases - should show correctly\n2. Properties with active leases - should show tenant info\n3. Empty properties list - should handle gracefully\n\n### Step 5: Commit\n\n```bash\ngit add client/src/pages/Properties.tsx\ngit commit -m \"perf(frontend): eliminate N+1 queries on Properties page\n\n- Batch fetch all active leases in single API call\n- Match leases to properties client-side\n- Reduces API calls from N+1 to 2 total\n- 10 properties: 11 calls -\u003e 2 calls (82% reduction)\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. Code updated to batch fetch leases\n2. Only 2 API calls made (check Network tab)\n3. All properties render correctly\n4. Active lease info displays correctly\n5. No change in UI or user experience\n6. Performance improvement visible with 5+ properties\n\n## Notes\n\n- Empty array check prevents unnecessary lease fetch\n- Client-side matching is efficient and simple\n- This is a pure performance optimization - no UX changes\n- Works with the updated leases service from previous bead","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:01:30.894292569Z","updated_at":"2026-01-19T16:49:38.307548069Z","closed_at":"2026-01-19T16:49:38.307548069Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-6s3","depends_on_id":"Task-uil","type":"blocks","created_at":"2026-01-17T18:02:06.944070438Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-6s3","depends_on_id":"Task-9jr","type":"blocks","created_at":"2026-01-17T18:02:07.682120536Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-7im","title":"HMAC signature verification","description":"Implement HMAC-based signature verification for webhook requests using MONZO_WEBHOOK_SECRET. Reject invalid signatures with 403.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:30.033271439Z","updated_at":"2026-01-21T20:09:06.725310395Z","closed_at":"2026-01-21T20:09:06.725310395Z","close_reason":"Implemented webhook security via secret URL path validation with timing-safe comparison using crypto.timingSafeEqual(). Monzo does not support HMAC signature verification, so implemented industry-standard secret URL approach. Returns 403 for invalid secrets. Both spec compliance and code quality reviews approved. All 14 tests passing.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-7im","depends_on_id":"Task-j3y","type":"parent-child","created_at":"2026-01-20T18:28:32.068575456Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-7im","depends_on_id":"Task-s6w","type":"blocks","created_at":"2026-01-20T18:31:31.883602778Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-7qr","title":"Phase 5: Admin UI","description":"Frontend components for bank account management, rule configuration, and pending transaction review","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:26:00.73965361Z","updated_at":"2026-01-24T17:48:05.325125009Z","closed_at":"2026-01-24T17:48:05.325125009Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-7qr","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:17.638416084Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-7qr","depends_on_id":"Task-hfb","type":"blocks","created_at":"2026-01-20T18:31:14.398859074Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-7xg","title":"Create Dashboard page with Material-UI overview cards, events widget, transactions list, and quick actions","description":"Build a comprehensive Dashboard page with the following components:\n- Overview cards displaying properties count, income, and expenses metrics\n- Upcoming events widget for important dates and reminders\n- Recent transactions list with pagination support\n- Quick action buttons for common operations\n- Responsive Material-UI Grid layout\n- Professional Material Design styling","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:08.897153785Z","updated_at":"2026-01-14T07:17:02.67582207Z","closed_at":"2026-01-14T07:17:02.67582207Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-7xg","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:27.273540038Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-7xg","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:16:27.808626236Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-7xg","depends_on_id":"Task-4q5","type":"blocks","created_at":"2026-01-13T11:16:28.336364612Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-7xg","depends_on_id":"Task-0ur","type":"blocks","created_at":"2026-01-13T11:16:28.857810553Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-85a","title":"Implement shared/reusable React components including PropertyCard, TenantCard, TransactionRow, EventBadge, FileUpload, ConfirmDialog, StatsCard, DateRangePicker, and PropertySelector","description":"Create shared/reusable React components in client/src/components/shared/ directory. All components should use Material-UI, TypeScript, and follow established patterns.\n\nDEPENDENCIES INSTALLATION:\nRun in client/ directory first:\nnpm install @mui/x-date-pickers date-fns\n\nCOMPONENT SPECIFICATIONS:\n\n1. PropertyCard (client/src/components/shared/PropertyCard.tsx)\n   - Display property summary for list views\n   - Props: property (Property type), onClick (optional)\n   - UI: Card with property name, address, status badge, property type\n   - Status badges with colors: Vacant (orange), On Market (blue), Rented (green), Maintenance (yellow)\n   - Fetch and display monthly rent from active lease for this property\n     * Query: prisma.lease.findFirst({ where: { propertyId, status: 'Active' }, select: { monthlyRent: true } })\n     * Use API client: getLeases({ property_id: propertyId, status: 'Active' })\n     * Show \"£X,XXX/month\" if active lease exists\n     * Show \"No active lease\" if vacant\n   - Clickable card (cursor pointer, hover effect)\n   - Responsive: full width on mobile, grid on desktop\n   - Loading state while fetching lease info\n\n2. TenantCard (client/src/components/shared/TenantCard.tsx)\n   - Display tenant summary for list views\n   - Props: tenant (Tenant type), onClick (optional)\n   - UI: Card with name, contact info (email/phone), status badge\n   - Status badges: Prospective (gray), Active (green), Former (red)\n   - For Active tenants: fetch and display current property name\n     * Query: prisma.lease.findFirst({ where: { tenantId, status: 'Active' }, include: { property: true } })\n     * Use API client: getLeases({ tenant_id: tenantId, status: 'Active' })\n     * Show property name below contact info: \"Current: [Property Name]\"\n     * Handle case where Active tenant has no active lease (data inconsistency)\n   - Display emergency contact indicator (icon if emergencyContactName exists)\n   - Clickable card with hover effect\n   - Loading state while fetching lease/property info\n\n3. TransactionRow (client/src/components/shared/TransactionRow.tsx)\n   - Table row component for transaction lists\n   - Props: transaction (Transaction type), onEdit, onDelete (optional)\n   - Columns: Date, Property, Type (Income/Expense), Category, Amount, Actions\n   - Amount color: green for income, red for expenses\n   - Format amount with currency (£) using Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' })\n   - Format date using date-fns format(date, 'MMM dd, yyyy') (e.g., \"Jan 15, 2026\")\n   - Action buttons: Edit (IconButton with EditIcon), Delete (IconButton with DeleteIcon)\n   - Responsive: stack on mobile, table row on desktop\n\n4. EventBadge (client/src/components/shared/EventBadge.tsx)\n   - Display event with color-coding for calendar\n   - Props: event (Event type), onClick (optional)\n   - Colors by type: Repair (orange), Renovation (blue), Rent Change (green), Tenant Change (purple), Inspection (yellow), Other (gray)\n   - Show checkmark icon if completed\n   - Display event title (truncate if long)\n   - Small chip/badge styling\n   - Tooltip with full details on hover (use Material-UI Tooltip)\n   - Format date in tooltip using date-fns\n\n5. FileUpload (client/src/components/shared/FileUpload.tsx)\n   - File upload component with drag-and-drop\n   - Props: onFileSelect (callback with File), accept (file types: string), maxSize (default 10MB = 10 * 1024 * 1024 bytes)\n   - UI: Dropzone with \"Click to upload or drag and drop\" text\n   - Show file preview after selection (name, size formatted with formatBytes helper, type/icon)\n   - Display error for invalid file type or size exceeding maxSize\n   - Allowed types: jpg, png, pdf (accept=\"image/jpeg,image/png,application/pdf\")\n   - Clear/remove file button (IconButton with CloseIcon)\n   - Progress indicator during upload (optional for now, can use LinearProgress)\n   - Material-UI Box with dashed border and CloudUploadIcon\n\n6. ConfirmDialog (client/src/components/shared/ConfirmDialog.tsx)\n   - Reusable confirmation dialog for delete actions\n   - Props: open (boolean), title, message, onConfirm, onCancel, loading (optional, default false)\n   - UI: Material-UI Dialog with WarningIcon\n   - Buttons: Cancel (outlined), Confirm (contained, error color)\n   - Disable buttons during loading\n   - Show CircularProgress on Confirm button when loading\n   - Default title: \"Confirm Action\"\n   - Default message: \"Are you sure you want to proceed?\"\n   - Use DialogTitle, DialogContent, DialogActions\n\n7. StatsCard (client/src/components/shared/StatsCard.tsx)\n   - Dashboard metric card\n   - Props: title (string), value (string | number), icon (ReactNode from @mui/icons-material), color (optional, default 'primary'), trend (optional: { value: number, direction: 'up' | 'down' })\n   - UI: Card with icon, title, large value text, optional trend indicator\n   - Icon in circular Avatar with specified color background\n   - Trend: small text with TrendingUpIcon (green) or TrendingDownIcon (red) and percentage\n   - Example usage: \u003cStatsCard title=\"Total Properties\" value={12} icon={\u003cHomeIcon /\u003e} /\u003e\n   - Responsive sizing: min-height 120px\n\n8. DateRangePicker (client/src/components/shared/DateRangePicker.tsx)\n   - Date range selection for filtering\n   - Props: startDate (Date | null), endDate (Date | null), onStartDateChange, onEndDateChange, label (optional)\n   - UI: Two DatePicker components side by side (From/To labels)\n   - Use @mui/x-date-pickers DatePicker with LocalizationProvider\n   - Provider: AdapterDateFns from @mui/x-date-pickers/AdapterDateFns\n   - Validation: startDate \u003c= endDate (show error helper text if invalid)\n   - Clear button (IconButton with ClearIcon) to reset both dates to null\n   - Responsive: stack vertically on mobile (use Stack component with direction={{ xs: 'column', sm: 'row' }})\n   - Date format: 'dd/MM/yyyy' (UK format)\n\n9. PropertySelector (client/src/components/shared/PropertySelector.tsx)\n   - Dropdown for filtering by property\n   - Props: value (propertyId string or 'all'), onChange (callback), includeAllOption (default true)\n   - Fetch properties list using API client getProperties() in useEffect\n   - UI: Material-UI Select or Autocomplete component\n   - Options: \"All Properties\" (value: 'all') as first option, then properties with label format: \"PropertyName - Street, Postcode\"\n   - Empty state if no properties: show \"No properties available\"\n   - Loading state while fetching: show CircularProgress or skeleton\n   - Use FormControl and InputLabel for proper Material-UI styling\n   - Sort properties by name alphabetically\n\nSHARED TYPES:\nCreate client/src/types/component.types.ts for component-specific prop types that don't come from API\n\nSTYLING:\n- Use Material-UI sx prop for styling\n- Follow theme colors and spacing (theme.spacing(), theme.palette)\n- Ensure responsive design (mobile-first, use theme.breakpoints)\n- Consistent spacing and sizing across components\n- Card elevation: 2 for cards, hover elevation: 4\n\nERROR HANDLING:\n- Graceful handling of missing data (show fallback text or skeleton)\n- PropTypes or TypeScript validation (strict TypeScript interfaces)\n- Console warnings for development (use import.meta.env.DEV)\n- Handle API fetch errors in PropertyCard and TenantCard (show error state or fallback)\n\nPERFORMANCE:\n- Use React.memo for components that receive frequent prop updates\n- Debounce API calls if needed (for PropertySelector search)\n- Cleanup useEffect subscriptions (AbortController for fetch requests)\n\nEXPORT:\nExport all components from index file: client/src/components/shared/index.ts\n```typescript\nexport { PropertyCard } from './PropertyCard';\nexport { TenantCard } from './TenantCard';\n// ... etc\n```\n\nEach component should be a standalone, reusable module that can be imported and used across different pages.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:20.093012264Z","updated_at":"2026-01-14T07:41:19.25806931Z","closed_at":"2026-01-14T07:41:19.25806931Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-85a","depends_on_id":"Task-atm","type":"blocks","created_at":"2026-01-13T11:16:12.191570595Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-860","title":"Fix Schema Alignment (Properties Page)","description":"## Overview\nFix the mismatch between frontend types (US format) and backend/validation (UK format). The Properties page crashes because:\n- Frontend `Property` type uses `state`, `zipCode` but DB uses `county`, `postcode`\n- Frontend `Lease` type uses `rentAmount` but DB uses `monthlyRent`\n- Property types don't match (frontend has 'Single Family' etc, DB has 'House', 'Flat' etc)\n\n## Files to Modify\n- `client/src/types/api.types.ts` - Update Property and Lease interfaces\n- `client/src/types/component.types.ts` - No changes needed (uses api.types)\n- `client/src/components/shared/PropertyCard.tsx` - Update to use `county`, `postcode`, `monthlyRent`\n- `client/src/pages/Properties.tsx` - Update form fields, labels, filter options\n\n## Implementation Steps\n\n### Step 1: Update api.types.ts Property interface\nChange:\n- `state: string` → `county: string`\n- `zipCode: string` → `postcode: string`  \n- `propertyType` values to: `'House' | 'Flat' | 'Studio' | 'Bungalow' | 'Terraced' | 'Semi-Detached' | 'Detached' | 'Maisonette' | 'Commercial'`\n- `status` values to: `'Available' | 'Occupied' | 'Under Maintenance' | 'For Sale'`\n- Remove `numberOfUnits`, `numberOfBedrooms`, `numberOfBathrooms`, `squareFootage`, `yearBuilt`, `currentValue` (not in DB schema)\n\n### Step 2: Update api.types.ts Lease interface\nChange:\n- `rentAmount` → `monthlyRent`\n- `securityDeposit` → `securityDepositAmount`\n- Add `securityDepositPaidDate?: string | null`\n- `status` values to: `'Draft' | 'Active' | 'Expired' | 'Terminated'`\n- Remove `terms` field (not in DB)\n\n### Step 3: Update PropertyCard.tsx\nChange line 23 address format from:\n`const address = \\`${property.street}, ${property.city}, ${property.state} ${property.zipCode}\\`;`\nto:\n`const address = \\`${property.street}, ${property.city}, ${property.county} ${property.postcode}\\`;`\n\nChange line 62 to use `monthlyRent`:\n`{formatRent(property.activeLease.monthlyRent)}`\n\n### Step 4: Update Properties.tsx\n- Update PROPERTY_STATUSES array to: `['Available', 'Occupied', 'Under Maintenance', 'For Sale']`\n- Update PROPERTY_TYPES array to: `['House', 'Flat', 'Studio', 'Bungalow', 'Terraced', 'Semi-Detached', 'Detached', 'Maisonette', 'Commercial']`\n- Remove form fields: numberOfUnits, numberOfBedrooms, numberOfBathrooms, squareFootage, yearBuilt, currentValue\n- Rename form field `state` → `county`, `zipCode` → `postcode`\n- Update labels: \"State\" → \"County\", \"Zip Code\" → \"Postcode\"\n- Update PropertyFormData interface accordingly\n- Update initialFormData object\n\n### Step 5: Verify\nRun: `npm run dev`\nNavigate to Properties page - should load without crash\nCreate/edit a property - form should work\n\n### Step 6: Commit\n```bash\ngit add client/src/types/api.types.ts client/src/components/shared/PropertyCard.tsx client/src/pages/Properties.tsx\ngit commit -m \"fix: align frontend types with UK database schema\"\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T17:23:33.51479935Z","updated_at":"2026-01-15T17:36:48.931107547Z","closed_at":"2026-01-15T17:36:48.931107547Z","close_reason":"Schema alignment complete. Spec and code quality reviews passed.","created_by":"Alexander Pezarro"}
{"id":"Task-8bj","title":"Backend: Add tests for batch lease queries","description":"## Overview\n\nAdd comprehensive tests for the new batch lease querying functionality to ensure it works correctly with single and multiple property IDs.\n\n## Files\n\n- Modify: `server/src/routes/__tests__/leases.test.ts`\n\n## Implementation Steps\n\n### Step 1: Review existing tests\n\nRead `server/src/routes/__tests__/leases.test.ts` to understand the test structure and existing GET /api/leases tests.\n\n### Step 2: Add test for multiple property IDs\n\nAdd a new test case in the GET /api/leases test suite:\n\n```javascript\ndescribe('GET /api/leases', () =\u003e {\n  // ... existing tests ...\n\n  it('should filter leases by multiple property IDs', async () =\u003e {\n    // Arrange: Create test properties and leases\n    const property1 = await createTestProperty({ name: 'Property 1' });\n    const property2 = await createTestProperty({ name: 'Property 2' });\n    const property3 = await createTestProperty({ name: 'Property 3' });\n    \n    const tenant1 = await createTestTenant();\n    const tenant2 = await createTestTenant();\n    \n    const lease1 = await createTestLease({ propertyId: property1.id, tenantId: tenant1.id });\n    const lease2 = await createTestLease({ propertyId: property2.id, tenantId: tenant2.id });\n    const lease3 = await createTestLease({ propertyId: property3.id, tenantId: tenant1.id });\n\n    // Act: Query for leases from property1 and property2 only\n    const response = await request(app)\n      .get('/api/leases')\n      .query({ property_id: [property1.id, property2.id] });\n\n    // Assert\n    expect(response.status).toBe(200);\n    expect(response.body.success).toBe(true);\n    expect(response.body.leases).toHaveLength(2);\n    \n    const leaseIds = response.body.leases.map(l =\u003e l.id);\n    expect(leaseIds).toContain(lease1.id);\n    expect(leaseIds).toContain(lease2.id);\n    expect(leaseIds).not.toContain(lease3.id);\n  });\n\n  it('should handle single property ID as array', async () =\u003e {\n    // Arrange\n    const property = await createTestProperty();\n    const tenant = await createTestTenant();\n    const lease = await createTestLease({ propertyId: property.id, tenantId: tenant.id });\n\n    // Act: Query with single ID (gets converted to array by route)\n    const response = await request(app)\n      .get('/api/leases')\n      .query({ property_id: property.id });\n\n    // Assert\n    expect(response.status).toBe(200);\n    expect(response.body.success).toBe(true);\n    expect(response.body.leases).toHaveLength(1);\n    expect(response.body.leases[0].id).toBe(lease.id);\n  });\n});\n```\n\n### Step 3: Run the new tests\n\n```bash\nnpm test server/src/routes/__tests__/leases.test.ts\n```\n\nExpected: All tests pass, including the new batch query tests\n\n### Step 4: Run full test suite\n\n```bash\nnpm test\n```\n\nExpected: All tests pass with coverage thresholds met\n\n### Step 5: Commit\n\n```bash\ngit add server/src/routes/__tests__/leases.test.ts\ngit commit -m \"test(api): add tests for batch lease queries\n\n- Test filtering by multiple property IDs\n- Test backward compatibility with single property ID\n- Verify only requested properties' leases are returned\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. New tests added to test file\n2. Tests pass with `npm test`\n3. Coverage remains above thresholds (80% lines/functions/statements)\n4. Tests verify correct filtering behavior\n\n## Notes\n\n- Use existing test helper functions (createTestProperty, createTestTenant, etc.)\n- Ensure test data is properly cleaned up between tests\n- Tests verify both functionality and backward compatibility","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T18:01:32.359960879Z","updated_at":"2026-01-19T16:33:29.604476232Z","closed_at":"2026-01-19T16:33:29.604476232Z","close_reason":"Batch lease query tests implementation complete and approved","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-8bj","depends_on_id":"Task-uil","type":"blocks","created_at":"2026-01-17T18:02:04.263261669Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-8d8","title":"Add role-based conditional rendering to Documents page","description":"Modify client/src/pages/Documents.tsx to use canWrite() for conditional rendering. Hide Upload button and delete actions for users with viewer role. Follow the pattern established in Properties and Tenants pages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T18:00:08.476518688Z","updated_at":"2026-01-22T20:56:18.681810129Z","closed_at":"2026-01-22T20:56:18.681810129Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-8d8","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:52.241087847Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-98e","title":"Create deployment documentation including local network setup instructions, environment variable configuration, database backup procedures, and systemd service file for Linux deployment","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T10:48:19.948810254Z","updated_at":"2026-01-14T19:14:13.214801112Z","closed_at":"2026-01-14T19:14:13.214801112Z","close_reason":"Completed comprehensive deployment documentation with local network setup, environment configuration, systemd service, and backup procedures. Fixed Node.js path guidance and documentation references. Passed spec compliance and code quality reviews.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-98e","depends_on_id":"Task-1t8","type":"blocks","created_at":"2026-01-13T11:16:57.58050151Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-9jr","title":"Frontend: Update leases service for array property IDs","description":"## Overview\n\nUpdate the frontend leases service to handle propertyId as either a string or string array, building the appropriate query parameters for the backend API.\n\n## Files\n\n- Modify: `client/src/types/api.types.ts` (LeaseFilters interface)\n- Modify: `client/src/services/api/leases.service.ts`\n\n## Implementation Steps\n\n### Step 1: Update TypeScript types\n\nOpen `client/src/types/api.types.ts` and find the `LeaseFilters` interface.\n\nUpdate it to accept propertyId as string or string array:\n\n```typescript\nexport interface LeaseFilters {\n  propertyId?: string | string[];\n  tenantId?: string;\n  status?: 'Draft' | 'Active' | 'Expired' | 'Terminated';\n}\n```\n\n### Step 2: Update leases service\n\nOpen `client/src/services/api/leases.service.ts` and find the `getLeases` method.\n\nUpdate the query parameter building logic:\n\n```typescript\nasync getLeases(filters?: LeaseFilters): Promise\u003cLease[]\u003e {\n  const params = new URLSearchParams();\n\n  if (filters?.propertyId) {\n    // Handle both single and array property IDs\n    if (Array.isArray(filters.propertyId)) {\n      filters.propertyId.forEach(id =\u003e {\n        params.append('property_id', id);\n      });\n    } else {\n      params.append('property_id', filters.propertyId);\n    }\n  }\n\n  if (filters?.tenantId) {\n    params.append('tenant_id', filters.tenantId);\n  }\n\n  if (filters?.status) {\n    params.append('status', filters.status);\n  }\n\n  const response = await api.get\u003cLeasesResponse\u003e(`/leases?${params.toString()}`);\n  return response.data.leases;\n}\n```\n\n### Step 3: Verify TypeScript compilation\n\n```bash\nnpm run build\n```\n\nExpected: No TypeScript errors\n\n### Step 4: Test the service (optional manual test)\n\nIf you want to manually verify, you can temporarily add a console log to see the URL being built:\n\n```typescript\nconsole.log('Leases URL:', `/leases?${params.toString()}`);\n```\n\nTest in browser console or with a quick test component.\n\n### Step 5: Commit\n\n```bash\ngit add client/src/types/api.types.ts client/src/services/api/leases.service.ts\ngit commit -m \"feat(frontend): support array property IDs in leases service\n\n- Update LeaseFilters type to accept string | string[]\n- Build query params with repeated property_id for arrays\n- Enables batch lease fetching from frontend\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. TypeScript types updated\n2. Service method updated to handle arrays\n3. No TypeScript compilation errors\n4. Query params built correctly for both single and array inputs\n\n## Notes\n\n- URLSearchParams.append() is perfect for repeated query params\n- Backward compatible - existing single propertyId calls work unchanged\n- This enables the Properties page optimization","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:01:28.745559337Z","updated_at":"2026-01-17T18:42:54.604822189Z","closed_at":"2026-01-17T18:42:54.604822189Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-9jr","depends_on_id":"Task-uil","type":"blocks","created_at":"2026-01-17T18:02:04.912253852Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-9lo","title":"Integration: Test and verify API call optimizations","description":"## Overview\n\nComprehensive integration testing of all API call optimizations to verify they work correctly end-to-end and deliver the expected performance improvements.\n\n## Files\n\nNo file changes - this is a testing and verification bead.\n\n## Implementation Steps\n\n### Step 1: Backend API testing\n\nTest the leases endpoint with curl or Postman:\n\n**Test 1: Single property ID (backward compatibility)**\n```bash\ncurl \"http://localhost:3000/api/leases?property_id=VALID_UUID\"\n```\nExpected: Returns leases for that property with property and tenant data included\n\n**Test 2: Multiple property IDs (new functionality)**\n```bash\ncurl \"http://localhost:3000/api/leases?property_id=UUID1\u0026property_id=UUID2\"\n```\nExpected: Returns leases for both properties with property and tenant data included\n\n**Test 3: With status filter**\n```bash\ncurl \"http://localhost:3000/api/leases?property_id=UUID1\u0026property_id=UUID2\u0026status=Active\"\n```\nExpected: Returns only Active leases for both properties\n\n### Step 2: Run backend test suite\n\n```bash\nnpm test server/src/routes/__tests__/leases.test.ts\n```\n\nExpected: All tests pass including new batch query tests\n\n### Step 3: Frontend Properties page testing\n\nStart the app:\n```bash\nnpm run dev\n```\n\nOpen browser DevTools Network tab and navigate to Properties page.\n\n**Verify API call reduction:**\n- Before: Should have been N+1 calls (1 properties + N leases)\n- After: Should see exactly 2 calls:\n  1. GET /api/properties\n  2. GET /api/leases?property_id=...\u0026property_id=...\u0026status=Active\n\n**Verify functionality:**\n- All properties display correctly\n- Active lease information shows for occupied properties\n- Properties without active leases show correctly\n- Filters work (status, type, search)\n- Create/Edit/Delete operations work\n\n### Step 4: PropertySelector cache testing\n\n**Test duplicate call elimination:**\n\n1. Navigate to Transactions page\n2. Open Network tab and clear it\n3. Refresh the page\n4. Expected: NO /api/properties call (already cached)\n5. Open transaction dialog (contains PropertySelector)\n6. Expected: Properties populate from cache, no API call\n\n**Test with multiple selectors:**\n\n1. If any page has multiple PropertySelector instances\n2. Expected: Only ONE properties call total (from context on app load)\n3. All selectors show same data\n\n### Step 5: Cache invalidation testing\n\n**Test create invalidation:**\n1. Go to Properties page\n2. Create a new property\n3. Navigate to Transactions page\n4. Check PropertySelector dropdown\n5. Expected: New property appears immediately\n\n**Test update invalidation:**\n1. Edit a property name on Properties page\n2. Navigate to another page with PropertySelector\n3. Expected: Updated name shows in selector\n\n**Test delete invalidation:**\n1. Delete a property on Properties page\n2. Check PropertySelector on another page\n3. Expected: Deleted property no longer appears\n\n### Step 6: Performance measurement\n\n**Measure with browser DevTools:**\n\n1. Open Properties page with 10+ properties\n2. Hard refresh (Cmd+Shift+R or Ctrl+Shift+R)\n3. Check Network tab:\n   - Count total API calls\n   - Measure total load time\n   - Verify 2 calls instead of N+1\n\n**Expected improvements:**\n- 10 properties: 11 calls -\u003e 2 calls (82% reduction)\n- 20 properties: 21 calls -\u003e 2 calls (90% reduction)\n- Faster page load time\n- Reduced server load\n\n### Step 7: Run full test suite\n\n```bash\nnpm test\n```\n\nExpected: All tests pass with coverage above thresholds\n\n### Step 8: Build verification\n\n```bash\nnpm run build\n```\n\nExpected: Production build succeeds with no errors or warnings\n\n### Step 9: Document results\n\nCreate a summary of test results:\n- API call reduction achieved\n- Performance improvements measured\n- Any issues discovered and resolved\n- Verification checklist completed\n\n## Verification Checklist\n\nBackend:\n- [ ] Single property_id queries work\n- [ ] Multiple property_id queries work\n- [ ] Backward compatibility maintained\n- [ ] All backend tests pass\n\nFrontend - Properties Page:\n- [ ] Page loads correctly\n- [ ] API calls reduced from N+1 to 2\n- [ ] All properties display correctly\n- [ ] Active leases show correctly\n- [ ] CRUD operations work\n\nFrontend - PropertiesContext:\n- [ ] Properties cached on app load\n- [ ] useProperties hook works in all components\n- [ ] refetch() updates cache correctly\n- [ ] No duplicate properties calls\n\nFrontend - PropertySelector:\n- [ ] Uses cached properties\n- [ ] No local API calls\n- [ ] Multiple selectors share cache\n- [ ] Updates after mutations\n\nIntegration:\n- [ ] Full app functionality works\n- [ ] Performance improvement visible\n- [ ] No console errors\n- [ ] Production build succeeds\n\n## Notes\n\n- This verification ensures all optimizations work together\n- Performance gains should be significant with 5+ properties\n- Cache invalidation is critical for data consistency\n- All existing functionality must continue to work","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T18:01:32.976788314Z","updated_at":"2026-01-24T13:22:37.228209213Z","closed_at":"2026-01-24T13:22:37.228209213Z","close_reason":"Integration testing complete - all 769 tests passing, 7x performance improvement verified, N+1 problem eliminated","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-9lo","depends_on_id":"Task-8bj","type":"blocks","created_at":"2026-01-17T18:02:09.91535437Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-9lo","depends_on_id":"Task-dcr","type":"blocks","created_at":"2026-01-17T18:02:10.585289499Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-asm","title":"Add shared Role type and user types","description":"## Overview\nCreate shared TypeScript types for user roles and user interface to support the permissions system. This establishes the foundation for role-based access control across the application.\n\n## Files to Create/Modify\n- **Create**: `shared/types/user.types.ts` - New file containing Role type and User interface\n- **Modify**: `shared/types/index.ts` - Export new user types\n\n## Implementation Steps\n\n### Step 1: Create shared/types/user.types.ts\n\n```typescript\n// shared/types/user.types.ts\n\n/**\n * User roles for role-based access control\n * - ADMIN: Full system access, can manage all properties and users\n * - LANDLORD: Can manage own properties, tenants, and related data\n * - VIEWER: Read-only access to assigned properties\n */\nexport type Role = 'ADMIN' | 'LANDLORD' | 'VIEWER';\n\n/**\n * User entity interface\n */\nexport interface User {\n  id: number;\n  email: string;\n  name: string;\n  role: Role;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * User without sensitive data (for API responses)\n */\nexport interface PublicUser {\n  id: number;\n  email: string;\n  name: string;\n  role: Role;\n}\n```\n\n### Step 2: Update shared/types/index.ts\n\nAdd exports for the new user types:\n\n```typescript\n// Add to existing exports\nexport type { Role, User, PublicUser } from './user.types';\n```\n\n## Verification Steps\n\n1. **TypeScript Compilation Check**\n   ```bash\n   npx tsc --noEmit\n   ```\n   Should complete without errors.\n\n2. **Import Test**\n   Create a test file or verify imports work:\n   ```typescript\n   import { Role, User, PublicUser } from '../shared/types';\n   const role: Role = 'LANDLORD'; // Should type-check correctly\n   ```\n\n3. **Verify Exports**\n   ```bash\n   # Check that types are properly exported\n   grep -r \"export.*Role\" shared/types/\n   ```\n\n## Notes\n\n- These types will be used by both client and server\n- The Role type uses string literals for better type safety\n- PublicUser excludes sensitive fields like password hash\n- Matches the role column that will be added to the User table in Prisma schema\n- All three roles are designed to work with future permission checks\n\n## Commit Message\n```\nfeat: add shared user types with Role enum\n\n- Create shared/types/user.types.ts with Role type and User interfaces\n- Add Role type: 'ADMIN' | 'LANDLORD' | 'VIEWER'\n- Add User and PublicUser interfaces\n- Export types from shared/types/index.ts\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:57:22.311055682Z","updated_at":"2026-01-17T18:39:30.523897037Z","closed_at":"2026-01-17T18:39:30.523897037Z","close_reason":"Closed","created_by":"Alexander Pezarro"}
{"id":"Task-atm","title":"React frontend foundation with React Router setup, Material-UI theme configuration, authentication context, and main layout component with navigation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:48:00.790614157Z","updated_at":"2026-01-13T15:34:15.495980353Z","closed_at":"2026-01-13T15:34:15.495980353Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-atm","depends_on_id":"Task-tmr","type":"blocks","created_at":"2026-01-13T11:15:10.992290981Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-b22","title":"Security audit","description":"Comprehensive security review: signature validation, token encryption, audit logging, access control, rate limiting, and CSRF protection. Log all sensitive operations.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:39.617616756Z","updated_at":"2026-01-20T18:27:39.617616756Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-b22","depends_on_id":"Task-hkn","type":"parent-child","created_at":"2026-01-20T18:29:05.125680465Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-b30","title":"Authentication system with sessions","description":"## Overview\nImplement complete authentication system with bcrypt password hashing, express-session with SQLite store, and middleware for protecting routes.\n\n## Files\n- Create: `server/src/middleware/auth.ts`\n- Create: `server/src/routes/auth.ts`\n- Create: `server/src/services/auth.service.ts`\n- Create: `shared/types/auth.types.ts`\n- Modify: `server/src/server.ts` (add session and auth routes)\n\n## Implementation Steps\n\n### Step 1: Create shared auth types\n\n`shared/types/auth.types.ts`:\n```typescript\nexport interface LoginRequest {\n  email: string;\n  password: string;\n}\n\nexport interface User {\n  id: string;\n  email: string;\n}\n\nexport interface AuthResponse {\n  success: boolean;\n  user?: User;\n  error?: string;\n}\n\ndeclare module 'express-session' {\n  interface SessionData {\n    userId: string;\n  }\n}\n```\n\n### Step 2: Create auth service\n\n`server/src/services/auth.service.ts`:\n```typescript\nimport bcrypt from 'bcrypt';\nimport prisma from '../db/client';\nimport { User } from '../../shared/types/auth.types';\n\nconst SALT_ROUNDS = 10;\n\nexport class AuthService {\n  async createUser(email: string, password: string): Promise\u003cUser\u003e {\n    const hashedPassword = await bcrypt.hash(password, SALT_ROUNDS);\n    \n    const user = await prisma.user.create({\n      data: {\n        email,\n        password: hashedPassword,\n      },\n    });\n\n    return {\n      id: user.id,\n      email: user.email,\n    };\n  }\n\n  async validateCredentials(email: string, password: string): Promise\u003cUser | null\u003e {\n    const user = await prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (!user) {\n      return null;\n    }\n\n    const isValid = await bcrypt.compare(password, user.password);\n    if (!isValid) {\n      return null;\n    }\n\n    return {\n      id: user.id,\n      email: user.email,\n    };\n  }\n\n  async getUserById(id: string): Promise\u003cUser | null\u003e {\n    const user = await prisma.user.findUnique({\n      where: { id },\n    });\n\n    if (!user) {\n      return null;\n    }\n\n    return {\n      id: user.id,\n      email: user.email,\n    };\n  }\n}\n\nexport default new AuthService();\n```\n\n### Step 3: Create auth middleware\n\n`server/src/middleware/auth.ts`:\n```typescript\nimport { Request, Response, NextFunction } from 'express';\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({\n      success: false,\n      error: { code: 'UNAUTHORIZED', message: 'Authentication required' },\n    });\n  }\n  next();\n}\n```\n\n### Step 4: Create auth routes\n\n`server/src/routes/auth.ts`:\n```typescript\nimport { Router } from 'express';\nimport authService from '../services/auth.service';\nimport { LoginRequest, AuthResponse } from '../../shared/types/auth.types';\n\nconst router = Router();\n\nrouter.post('/login', async (req, res) =\u003e {\n  try {\n    const { email, password } = req.body as LoginRequest;\n\n    if (!email || !password) {\n      return res.status(400).json({\n        success: false,\n        error: { code: 'VALIDATION_ERROR', message: 'Email and password required' },\n      });\n    }\n\n    const user = await authService.validateCredentials(email, password);\n\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        error: { code: 'INVALID_CREDENTIALS', message: 'Invalid email or password' },\n      });\n    }\n\n    req.session.userId = user.id;\n\n    res.json({\n      success: true,\n      data: { user },\n    });\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      error: { code: 'SERVER_ERROR', message: 'An error occurred during login' },\n    });\n  }\n});\n\nrouter.post('/logout', (req, res) =\u003e {\n  req.session.destroy((err) =\u003e {\n    if (err) {\n      return res.status(500).json({\n        success: false,\n        error: { code: 'SERVER_ERROR', message: 'Could not log out' },\n      });\n    }\n    res.json({ success: true });\n  });\n});\n\nrouter.get('/me', async (req, res) =\u003e {\n  if (!req.session.userId) {\n    return res.status(401).json({\n      success: false,\n      error: { code: 'UNAUTHORIZED', message: 'Not authenticated' },\n    });\n  }\n\n  try {\n    const user = await authService.getUserById(req.session.userId);\n    if (!user) {\n      req.session.destroy(() =\u003e {});\n      return res.status(401).json({\n        success: false,\n        error: { code: 'USER_NOT_FOUND', message: 'User no longer exists' },\n      });\n    }\n\n    res.json({\n      success: true,\n      data: { user },\n    });\n  } catch (error) {\n    console.error('Get user error:', error);\n    res.status(500).json({\n      success: false,\n      error: { code: 'SERVER_ERROR', message: 'Could not retrieve user' },\n    });\n  }\n});\n\nexport default router;\n```\n\n### Step 5: Update server.ts with session\n\nModify `server/src/server.ts`:\n```typescript\nimport express from 'express';\nimport session from 'express-session';\nimport helmet from 'helmet';\nimport rateLimit from 'express-rate-limit';\nimport createSqliteStore from 'better-sqlite3-session-store';\nimport Database from 'better-sqlite3';\nimport path from 'path';\nimport authRoutes from './routes/auth';\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Session store\nconst SqliteStore = createSqliteStore(session);\nconst db = new Database(path.join(__dirname, '../../data/sessions.db'));\n\n// Security middleware\napp.use(helmet());\napp.use(rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 100\n}));\n\n// Body parsing\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\n// Session configuration\napp.use(session({\n  store: new SqliteStore({\n    client: db,\n    expired: {\n      clear: true,\n      intervalMs: 900000 // 15 minutes\n    }\n  }),\n  secret: process.env.SESSION_SECRET || 'your-secret-key-change-this',\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: 24 * 60 * 60 * 1000 // 24 hours\n  }\n}));\n\n// Routes\napp.use('/api/auth', authRoutes);\n\n// Health check\napp.get('/api/health', (req, res) =\u003e {\n  res.json({ status: 'ok', timestamp: new Date().toISOString() });\n});\n\n// Start server\napp.listen(PORT, () =\u003e {\n  console.log(`Server running on port ${PORT}`);\n});\n\nexport default app;\n```\n\n### Step 6: Create initial user\n\nCreate `server/src/scripts/create-user.ts`:\n```typescript\nimport authService from '../services/auth.service';\n\nasync function createUser() {\n  const email = process.argv[2] || 'admin@example.com';\n  const password = process.argv[3] || 'admin123';\n\n  try {\n    const user = await authService.createUser(email, password);\n    console.log('✅ User created successfully:', user);\n  } catch (error: any) {\n    if (error.code === 'P2002') {\n      console.error('❌ User already exists with this email');\n    } else {\n      console.error('❌ Error creating user:', error);\n    }\n  }\n  process.exit(0);\n}\n\ncreateUser();\n```\n\nRun:\n```bash\ntsx server/src/scripts/create-user.ts admin@example.com password123\n```\n\nExpected: \"✅ User created successfully\"\n\n### Step 7: Test authentication\n\n```bash\n# Test login\ncurl -X POST http://localhost:3000/api/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\":\"admin@example.com\",\"password\":\"password123\"}' \\\n  -c cookies.txt\n\n# Test /me endpoint\ncurl http://localhost:3000/api/auth/me -b cookies.txt\n\n# Test logout\ncurl -X POST http://localhost:3000/api/auth/logout -b cookies.txt\n```\n\nExpected: Login returns user object, /me returns user, logout succeeds\n\n### Step 8: Commit\n\n```bash\ngit add server/src/middleware/ server/src/routes/auth.ts server/src/services/auth.service.ts shared/types/auth.types.ts server/src/server.ts server/src/scripts/\ngit commit -m \"feat: add authentication system with sessions\"\n```\n\n## Verification\n\n- [ ] User can be created via script\n- [ ] Login with correct credentials returns user object and sets session\n- [ ] Login with incorrect credentials returns 401 error\n- [ ] /me endpoint returns user when authenticated\n- [ ] /me endpoint returns 401 when not authenticated\n- [ ] Logout destroys session\n- [ ] Sessions persist across server restarts (SQLite store)\n- [ ] Session cookies are httpOnly and secure in production\n\n## Notes\n\n- Password is hashed with bcrypt (10 rounds)\n- Sessions stored in SQLite for persistence\n- Session max age is 24 hours\n- Cookie security settings depend on NODE_ENV\n- Create at least one user before testing frontend","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-13T10:47:38.501139423Z","updated_at":"2026-01-13T13:39:41.280549673Z","closed_at":"2026-01-13T13:39:41.280549673Z","close_reason":"Authentication system implemented with bcrypt password hashing, SQLite-backed sessions, comprehensive tests (13/13 passing), and secure cookie configuration. Spec compliant and code quality approved.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-b30","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:24.086715562Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-b6b","title":"Financial reporting features including income statement (P\u0026L), category breakdown with charts, property performance metrics, and CSV export functionality. Use recharts or similar for visualizations.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:20.496497572Z","updated_at":"2026-01-14T18:37:57.449501163Z","closed_at":"2026-01-14T18:37:57.449501163Z","close_reason":"Completed with comprehensive financial reporting features: P\u0026L reports, category charts, property performance metrics, and CSV exports. Passed spec compliance and code quality reviews.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-b6b","depends_on_id":"Task-0in","type":"blocks","created_at":"2026-01-13T11:16:50.354431717Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-b6b","depends_on_id":"Task-4q5","type":"blocks","created_at":"2026-01-13T11:16:50.839713084Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-bg9","title":"Frontend: Integrate PropertiesProvider in App","description":"## Overview\n\nWrap the application with PropertiesProvider to make properties context available throughout the app.\n\n## Files\n\n- Modify: `client/src/App.tsx`\n\n## Implementation Steps\n\n### Step 1: Review current App structure\n\nRead `client/src/App.tsx` to understand the current provider structure. It likely has AuthProvider already.\n\n### Step 2: Import PropertiesProvider\n\nAdd import at the top of the file:\n\n```typescript\nimport { PropertiesProvider } from './contexts/PropertiesContext';\n```\n\n### Step 3: Add PropertiesProvider wrapper\n\nWrap the app routes with PropertiesProvider. The provider should be inside AuthProvider (since properties need auth) but outside routes:\n\n```typescript\nfunction App() {\n  return (\n    \u003cAuthProvider\u003e\n      \u003cToastProvider\u003e\n        \u003cPropertiesProvider\u003e\n          \u003cRouter\u003e\n            {/* routes */}\n          \u003c/Router\u003e\n        \u003c/PropertiesProvider\u003e\n      \u003c/ToastProvider\u003e\n    \u003c/AuthProvider\u003e\n  );\n}\n```\n\nThe exact structure may vary - ensure PropertiesProvider wraps the Router/routes.\n\n### Step 4: Test the app starts\n\n```bash\nnpm run dev:client\n```\n\nExpected: App starts without errors, no console warnings\n\n### Step 5: Verify in browser DevTools\n\nOpen browser DevTools and check:\n- No errors in console\n- Network tab shows properties API call on app load\n- React DevTools shows PropertiesProvider in component tree\n\n### Step 6: Commit\n\n```bash\ngit add client/src/App.tsx\ngit commit -m \"feat(frontend): integrate PropertiesProvider in App\n\n- Wrap app with PropertiesProvider\n- Makes properties context available to all components\n- Properties fetched once on app mount\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. Import added correctly\n2. Provider wraps the app routes\n3. App starts and runs without errors\n4. Properties API call made on app load\n5. No duplicate properties calls visible in Network tab\n\n## Notes\n\n- Provider should be inside AuthProvider (properties might need auth)\n- Provider should wrap Router so all routes can access context\n- This makes the context available before any page renders","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T18:01:19.582208356Z","updated_at":"2026-01-18T22:49:25.270386407Z","closed_at":"2026-01-18T22:49:25.270386407Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-bg9","depends_on_id":"Task-ovu","type":"blocks","created_at":"2026-01-17T18:02:05.589320446Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-bhk","title":"Login page component with React Hook Form, Zod validation, Material-UI styling, and integration with auth context. Include protected route wrapper.","description":"Refactor the existing Login page to use React Hook Form with Zod validation, replacing the current basic state management implementation.\n\nDEPENDENCIES INSTALLATION:\nRun in client/ directory first:\nnpm install react-hook-form @hookform/resolvers zod\n\nFILE LOCATION:\n- client/src/pages/Login.tsx (modify existing file)\n\nCURRENT STATE:\n- Basic implementation using useState for form fields\n- Direct fetch calls to API\n- Basic validation (required fields only)\n\nTARGET IMPLEMENTATION:\n\n1. FORM MANAGEMENT:\n   - Replace useState with React Hook Form's useForm hook\n   - Use zodResolver to integrate Zod validation\n   - Fields: email (email validation), password (min 8 chars)\n   - Form submission handling with proper error states\n\n2. VALIDATION SCHEMA:\n   Create client/src/validation/auth.validation.ts:\n   ```typescript\n   import { z } from 'zod';\n   \n   export const LoginFormSchema = z.object({\n     email: z.string().email('Invalid email address'),\n     password: z.string().min(8, 'Password must be at least 8 characters'),\n   });\n   \n   export type LoginFormData = z.infer\u003ctypeof LoginFormSchema\u003e;\n   ```\n\n3. COMPONENT STRUCTURE:\n   - Import useForm from 'react-hook-form' and zodResolver from '@hookform/resolvers/zod'\n   - Initialize form with zodResolver(LoginFormSchema)\n   - Use Controller or register() for form fields\n   - Display field-level errors using form.formState.errors\n   - Show API errors separately in Alert component\n   - Disable submit button during loading and when form is invalid\n\n4. MATERIAL-UI INTEGRATION:\n   - TextField components should display validation errors\n   - Use error and helperText props to show field errors\n   - Maintain existing styling and layout\n   - Keep Paper, Container, Box structure\n\n5. AUTHENTICATION:\n   - Keep existing useAuth hook integration\n   - Handle login success/failure\n   - Navigate to /dashboard on success\n   - Show error messages in Alert on failure\n\n6. LOADING STATES:\n   - Disable form during submission\n   - Update button text: \"Sign In\" → \"Signing in...\"\n   - Prevent multiple submissions\n\nTESTING:\n- Test email validation (invalid format)\n- Test password length validation\n- Test successful login flow\n- Test error display for invalid credentials\n- Test loading states\n\nThe ProtectedRoute wrapper already exists and works correctly - no changes needed there.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:48:00.984830128Z","updated_at":"2026-01-13T20:49:34.56698826Z","closed_at":"2026-01-13T20:49:34.56698826Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-bhk","depends_on_id":"Task-atm","type":"blocks","created_at":"2026-01-13T11:16:10.068235478Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-bhk","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:16:10.584370299Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-bx3","title":"Amount conversion utility","description":"Implement utility to convert Monzo amounts (integer pence) to decimal pounds. Handle positive/negative values correctly (income/expense)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:48.465246575Z","updated_at":"2026-01-21T20:58:39.306060649Z","closed_at":"2026-01-21T20:58:39.306060649Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-bx3","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:40.881854914Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-c8y","title":"Implement permissions middleware with role hierarchy","description":"Create server/src/middleware/permissions.ts with role-based permission middleware:\n\n**Implementation Requirements:**\n- Implement requireRole(role: Role) - checks if user has at least the specified role level\n- Implement requireWrite() - shorthand for LANDLORD+ access (no VIEWER)\n- Implement requireAdmin() - shorthand for ADMIN only access\n- Role hierarchy: ADMIN \u003e LANDLORD \u003e VIEWER\n- All middleware should be compatible with requireAuth (assumes req.user exists)\n- Return 403 Forbidden with appropriate error messages for insufficient permissions\n\n**Complete Code Implementation:**\n```typescript\n// server/src/middleware/permissions.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { Role } from '@prisma/client';\n\n// Role hierarchy mapping\nconst roleHierarchy: Record\u003cRole, number\u003e = {\n  ADMIN: 3,\n  LANDLORD: 2,\n  VIEWER: 1,\n};\n\n// Check if user has at least the required role level\nexport const requireRole = (requiredRole: Role) =\u003e {\n  return (req: Request, res: Response, next: NextFunction): void =\u003e {\n    if (!req.user) {\n      res.status(401).json({ error: 'Not authenticated' });\n      return;\n    }\n\n    const userRoleLevel = roleHierarchy[req.user.role];\n    const requiredRoleLevel = roleHierarchy[requiredRole];\n\n    if (userRoleLevel \u003e= requiredRoleLevel) {\n      next();\n    } else {\n      res.status(403).json({ \n        error: `Insufficient permissions. Required role: ${requiredRole}` \n      });\n    }\n  };\n};\n\n// Require LANDLORD or ADMIN (no VIEWER)\nexport const requireWrite = () =\u003e requireRole(Role.LANDLORD);\n\n// Require ADMIN only\nexport const requireAdmin = () =\u003e requireRole(Role.ADMIN);\n```\n\n**Test Requirements:**\nCreate server/src/middleware/__tests__/permissions.test.ts with comprehensive test coverage:\n\n**Test Cases:**\n1. requireRole() tests:\n   - ADMIN can access ADMIN routes\n   - ADMIN can access LANDLORD routes\n   - ADMIN can access VIEWER routes\n   - LANDLORD can access LANDLORD routes\n   - LANDLORD can access VIEWER routes\n   - LANDLORD cannot access ADMIN routes\n   - VIEWER can access VIEWER routes\n   - VIEWER cannot access LANDLORD routes\n   - VIEWER cannot access ADMIN routes\n   - Unauthenticated user (no req.user) returns 401\n\n2. requireWrite() tests:\n   - ADMIN can access write routes\n   - LANDLORD can access write routes\n   - VIEWER cannot access write routes (403)\n\n3. requireAdmin() tests:\n   - ADMIN can access admin routes\n   - LANDLORD cannot access admin routes (403)\n   - VIEWER cannot access admin routes (403)\n\n4. Integration tests:\n   - Works correctly when chained after requireAuth\n   - Proper error messages in 403 responses\n\n**Complete Test Code:**\n```typescript\n// server/src/middleware/__tests__/permissions.test.ts\nimport { Request, Response } from 'express';\nimport { Role } from '@prisma/client';\nimport { requireRole, requireWrite, requireAdmin } from '../permissions';\n\ndescribe('Permissions Middleware', () =\u003e {\n  let mockRequest: Partial\u003cRequest\u003e;\n  let mockResponse: Partial\u003cResponse\u003e;\n  let nextFunction: jest.Mock;\n\n  beforeEach(() =\u003e {\n    mockRequest = {};\n    mockResponse = {\n      status: jest.fn().mockReturnThis(),\n      json: jest.fn(),\n    };\n    nextFunction = jest.fn();\n  });\n\n  describe('requireRole', () =\u003e {\n    it('should allow ADMIN to access ADMIN routes', () =\u003e {\n      mockRequest.user = { id: 1, role: Role.ADMIN };\n      const middleware = requireRole(Role.ADMIN);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n      expect(mockResponse.status).not.toHaveBeenCalled();\n    });\n\n    it('should allow ADMIN to access LANDLORD routes', () =\u003e {\n      mockRequest.user = { id: 1, role: Role.ADMIN };\n      const middleware = requireRole(Role.LANDLORD);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should allow ADMIN to access VIEWER routes', () =\u003e {\n      mockRequest.user = { id: 1, role: Role.ADMIN };\n      const middleware = requireRole(Role.VIEWER);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should allow LANDLORD to access LANDLORD routes', () =\u003e {\n      mockRequest.user = { id: 2, role: Role.LANDLORD };\n      const middleware = requireRole(Role.LANDLORD);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should allow LANDLORD to access VIEWER routes', () =\u003e {\n      mockRequest.user = { id: 2, role: Role.LANDLORD };\n      const middleware = requireRole(Role.VIEWER);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should not allow LANDLORD to access ADMIN routes', () =\u003e {\n      mockRequest.user = { id: 2, role: Role.LANDLORD };\n      const middleware = requireRole(Role.ADMIN);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Insufficient permissions. Required role: ADMIN',\n      });\n    });\n\n    it('should allow VIEWER to access VIEWER routes', () =\u003e {\n      mockRequest.user = { id: 3, role: Role.VIEWER };\n      const middleware = requireRole(Role.VIEWER);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should not allow VIEWER to access LANDLORD routes', () =\u003e {\n      mockRequest.user = { id: 3, role: Role.VIEWER };\n      const middleware = requireRole(Role.LANDLORD);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Insufficient permissions. Required role: LANDLORD',\n      });\n    });\n\n    it('should not allow VIEWER to access ADMIN routes', () =\u003e {\n      mockRequest.user = { id: 3, role: Role.VIEWER };\n      const middleware = requireRole(Role.ADMIN);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Insufficient permissions. Required role: ADMIN',\n      });\n    });\n\n    it('should return 401 if user is not authenticated', () =\u003e {\n      mockRequest.user = undefined;\n      const middleware = requireRole(Role.VIEWER);\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(401);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Not authenticated',\n      });\n    });\n  });\n\n  describe('requireWrite', () =\u003e {\n    it('should allow ADMIN to access write routes', () =\u003e {\n      mockRequest.user = { id: 1, role: Role.ADMIN };\n      const middleware = requireWrite();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should allow LANDLORD to access write routes', () =\u003e {\n      mockRequest.user = { id: 2, role: Role.LANDLORD };\n      const middleware = requireWrite();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should not allow VIEWER to access write routes', () =\u003e {\n      mockRequest.user = { id: 3, role: Role.VIEWER };\n      const middleware = requireWrite();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Insufficient permissions. Required role: LANDLORD',\n      });\n    });\n  });\n\n  describe('requireAdmin', () =\u003e {\n    it('should allow ADMIN to access admin routes', () =\u003e {\n      mockRequest.user = { id: 1, role: Role.ADMIN };\n      const middleware = requireAdmin();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).toHaveBeenCalled();\n    });\n\n    it('should not allow LANDLORD to access admin routes', () =\u003e {\n      mockRequest.user = { id: 2, role: Role.LANDLORD };\n      const middleware = requireAdmin();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n      expect(mockResponse.json).toHaveBeenCalledWith({\n        error: 'Insufficient permissions. Required role: ADMIN',\n      });\n    });\n\n    it('should not allow VIEWER to access admin routes', () =\u003e {\n      mockRequest.user = { id: 3, role: Role.VIEWER };\n      const middleware = requireAdmin();\n      \n      middleware(mockRequest as Request, mockResponse as Response, nextFunction);\n      \n      expect(nextFunction).not.toHaveBeenCalled();\n      expect(mockResponse.status).toHaveBeenCalledWith(403);\n    });\n  });\n});\n```\n\n**Execution Steps:**\n1. Create server/src/middleware/permissions.ts with the implementation above\n2. Create server/src/middleware/__tests__/permissions.test.ts with the test suite above\n3. Run tests: npm test permissions.test.ts\n4. Verify all tests pass\n5. Commit with message: \"feat: add role-based permission middleware\"\n\n**Acceptance Criteria:**\n- All middleware functions implemented correctly\n- Role hierarchy enforced (ADMIN \u003e LANDLORD \u003e VIEWER)\n- All test cases pass\n- Test coverage meets project thresholds (80%+ lines/functions/statements)\n- 403 responses include clear error messages\n- Works correctly with requireAuth middleware","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:57:41.846406674Z","updated_at":"2026-01-18T18:03:17.354786272Z","closed_at":"2026-01-18T18:03:17.354786272Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-c8y","depends_on_id":"Task-asm","type":"blocks","created_at":"2026-01-17T18:01:22.628685089Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-c8y","depends_on_id":"Task-g0x","type":"blocks","created_at":"2026-01-17T18:01:23.213387992Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-ce7","title":"Default rules setup","description":"Create sensible default matching rules: rent→Income/Rent, deposit→Income/Security Deposit, maintenance→Expense/Maintenance, repair→Expense/Repair, amount\u003c0→Expense/Other","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:04.033697109Z","updated_at":"2026-01-22T18:26:25.675314863Z","closed_at":"2026-01-22T18:26:25.675314863Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-ce7","depends_on_id":"Task-hfb","type":"parent-child","created_at":"2026-01-20T18:28:48.749092364Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-cmd","title":"Add admin-only permission checks to users routes","description":"Modify server/src/routes/users.ts to restrict user management to admins:\n\n1. Add requireAdmin() middleware to existing routes:\n   - GET /api/users (list all users)\n   - POST /api/users (create new user)\n   - DELETE /api/users/:id (delete user)\n\nApply middleware: router.get('/', requireAuth, requireAdmin(), async (req, res) =\u003e { ... })\n\n2. Create new PUT /api/users/:id/role endpoint:\n   - Path: /api/users/:id/role\n   - Middleware: requireAuth, requireAdmin()\n   - Request body: { role: 'ADMIN' | 'LANDLORD' | 'VIEWER' }\n   - Validations:\n     a. Prevent users from changing their own role\n        if (req.user!.id === parseInt(id)) return res.status(403).json({ error: 'Cannot change your own role' });\n     b. Ensure at least one ADMIN remains\n        if (currentUser.role === 'ADMIN' \u0026\u0026 role !== 'ADMIN') {\n          const adminCount = await prisma.user.count({ where: { role: 'ADMIN' } });\n          if (adminCount \u003c= 1) return res.status(400).json({ error: 'Cannot remove last admin' });\n        }\n   - Update user role in database\n   - Return updated user object\n\nComplete implementation:\n\nrouter.put('/:id/role', requireAuth, requireAdmin(), async (req, res) =\u003e {\n  const { id } = req.params;\n  const { role } = req.body;\n  \n  if (req.user!.id === parseInt(id)) {\n    return res.status(403).json({ error: 'Cannot change your own role' });\n  }\n  \n  const currentUser = await prisma.user.findUnique({ where: { id: parseInt(id) } });\n  if (!currentUser) return res.status(404).json({ error: 'User not found' });\n  \n  if (currentUser.role === 'ADMIN' \u0026\u0026 role !== 'ADMIN') {\n    const adminCount = await prisma.user.count({ where: { role: 'ADMIN' } });\n    if (adminCount \u003c= 1) {\n      return res.status(400).json({ error: 'Cannot remove last admin' });\n    }\n  }\n  \n  const user = await prisma.user.update({\n    where: { id: parseInt(id) },\n    data: { role },\n  });\n  \n  res.json(user);\n});\n\n3. Update tests in server/src/routes/__tests__/users.test.ts:\n   - Test VIEWER users blocked from GET /api/users (403)\n   - Test LANDLORD users blocked from POST /api/users (403)\n   - Test VIEWER users blocked from DELETE /api/users/:id (403)\n   - Test role change endpoint success\n   - Test prevention of self-role-change\n   - Test prevention of removing last admin\n   - Mock different user roles in tests\n\nTest cases to add:\n- 'should block VIEWER from listing users'\n- 'should block LANDLORD from creating users'\n- 'should block VIEWER from deleting users'\n- 'should allow admin to change user role'\n- 'should prevent changing own role'\n- 'should prevent removing last admin'\n\nCommit message: feat: restrict user management to admins only","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:59:02.655228606Z","updated_at":"2026-01-18T22:34:52.545090787Z","closed_at":"2026-01-18T22:34:52.545090787Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-cmd","depends_on_id":"Task-usd","type":"blocks","created_at":"2026-01-17T18:01:25.926120963Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-cmd","depends_on_id":"Task-g0x","type":"blocks","created_at":"2026-01-17T18:01:26.645281874Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-cmd","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:27.394128371Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-cpb","title":"Add requireWrite middleware to leases routes","description":"Modify server/src/routes/leases.ts to add requireWrite() middleware to POST/PUT/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/leases.test.ts to verify that users with VIEWER role are blocked from write operations while users with EDITOR or ADMIN roles can perform writes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:54.81988203Z","updated_at":"2026-01-21T16:29:05.144084313Z","closed_at":"2026-01-21T16:29:05.144084313Z","close_reason":"Added requireWrite middleware to all write endpoints with comprehensive role-based tests","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-cpb","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:36.737066136Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-d3h","title":"Implement Tenants CRUD API with endpoints for create, read, update, delete, and list operations. Add filtering by tenant status (prospective/active/former). Implement Zod validation schemas for all tenant data including personal info, contact details, and lease associations. Create endpoint for retrieving tenant lease history with property details and date ranges. Include error handling and proper HTTP status codes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:47:40.374164515Z","updated_at":"2026-01-13T15:21:36.14216717Z","closed_at":"2026-01-13T15:21:36.14216717Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-d3h","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:47.873343195Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-d3h","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:46.90271994Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-d3h","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:47.391076931Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-dcr","title":"Frontend: Add PropertiesContext refetch after mutations","description":"## Overview\n\nAdd calls to PropertiesContext.refetch() after property create/update/delete operations to keep the cached properties data in sync with the backend.\n\n## Files\n\n- Modify: `client/src/pages/Properties.tsx`\n\n## Implementation Steps\n\n### Step 1: Import useProperties hook\n\nAdd the import at the top of the file:\n\n```typescript\nimport { useProperties } from '../contexts/PropertiesContext';\n```\n\n### Step 2: Get refetch function from context\n\nInside the Properties component, add:\n\n```typescript\nconst { refetch: refetchPropertiesContext } = useProperties();\n```\n\nNote: Using alias to avoid confusion with local fetchProperties function.\n\n### Step 3: Add refetch after create\n\nFind the handleSubmit function where properties are created (around line 223-241).\n\nAfter successful creation, add refetch call:\n\n```typescript\nif (dialogMode === 'create') {\n  await propertiesService.createProperty(dataToSubmit);\n  toast.success('Property created successfully');\n  await refetchPropertiesContext(); // Add this line\n} else if (selectedProperty) {\n  // ... update logic\n}\n```\n\n### Step 4: Add refetch after update\n\nIn the same handleSubmit function, after successful update:\n\n```typescript\n} else if (selectedProperty) {\n  await propertiesService.updateProperty(\n    selectedProperty.id,\n    dataToSubmit as UpdatePropertyRequest\n  );\n  toast.success('Property updated successfully');\n  await refetchPropertiesContext(); // Add this line\n}\n```\n\n### Step 5: Add refetch after delete\n\nFind the handleDeleteConfirm function (around line 254-271).\n\nAfter successful deletion, add refetch call:\n\n```typescript\nawait propertiesService.deleteProperty(propertyToDelete.id);\ntoast.success('Property deleted successfully');\nawait refetchPropertiesContext(); // Add this line\nsetDeleteDialogOpen(false);\n```\n\n### Step 6: Test the cache invalidation\n\nStart the app:\n```bash\nnpm run dev\n```\n\nTest each mutation:\n1. **Create property**: Create a new property, then navigate to Transactions page\n   - Expected: New property appears in PropertySelector immediately\n2. **Update property**: Edit a property name, then check PropertySelector in another page\n   - Expected: Updated name shows immediately\n3. **Delete property**: Delete a property, then check PropertySelector\n   - Expected: Deleted property removed from all selectors\n\n### Step 7: Commit\n\n```bash\ngit add client/src/pages/Properties.tsx\ngit commit -m \"feat(frontend): invalidate PropertiesContext cache after mutations\n\n- Call refetch() after create/update/delete operations\n- Keeps cached properties in sync with backend\n- PropertySelectors across app show current data\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. Import added for useProperties hook\n2. refetch called after all three mutation types\n3. Cache updates correctly after create\n4. Cache updates correctly after update\n5. Cache updates correctly after delete\n6. PropertySelectors in other pages show fresh data\n\n## Notes\n\n- Using alias (refetchPropertiesContext) avoids naming collision\n- await ensures cache is updated before moving on\n- This keeps all PropertySelectors in sync across the app\n- Small performance cost but ensures data consistency","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T18:01:29.520492943Z","updated_at":"2026-01-22T21:11:43.919158642Z","closed_at":"2026-01-22T21:11:43.919158642Z","close_reason":"Spec requirements met - refetch calls added after mutations. Architectural improvements noted by reviewer are valid but outside bead scope.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-dcr","depends_on_id":"Task-hov","type":"blocks","created_at":"2026-01-17T18:02:08.498009119Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-dcr","depends_on_id":"Task-6s3","type":"blocks","created_at":"2026-01-17T18:02:09.18238094Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-dep","title":"OAuth flow with historical range selector","description":"Implement OAuth endpoints: POST /api/bank/monzo/connect and GET /api/bank/monzo/callback with historical date range selection UI (default 90 days, max 5 years)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:17.001833489Z","updated_at":"2026-01-21T17:46:56.301065641Z","closed_at":"2026-01-21T17:46:56.301065641Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-dep","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:24.941440969Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-dep","depends_on_id":"Task-22x","type":"blocks","created_at":"2026-01-20T18:31:25.183864477Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-dep","depends_on_id":"Task-kez","type":"blocks","created_at":"2026-01-20T18:31:25.809079041Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-drp","title":"Update seed script to create users with roles","description":"## Overview\nUpdate the database seed script to create users with different roles (ADMIN, LANDLORD, VIEWER) to support the new role-based access control system.\n\n## Tasks\n1. Locate the seed script (likely `prisma/seed.ts` or similar)\n\n2. Modify seed script to create users with roles:\n   ```typescript\n   // Example seed data structure\n   const users = [\n     {\n       email: 'admin@example.com',\n       password: await hashPassword('admin123'),\n       role: 'ADMIN'  // First user should be ADMIN\n     },\n     {\n       email: 'landlord@example.com',\n       password: await hashPassword('landlord123'),\n       role: 'LANDLORD'\n     },\n     {\n       email: 'viewer@example.com',\n       password: await hashPassword('viewer123'),\n       role: 'VIEWER'\n     }\n   ];\n   ```\n\n3. Ensure first user created is always ADMIN for initial access\n\n4. Run the seed script:\n   ```bash\n   npm run db:seed\n   ```\n\n## Verification Steps\n- Database should contain users with different roles\n- Verify ADMIN user exists and can be used for login\n- Check that existing seed data relationships still work\n- Test login with each seeded user\n- Confirm no duplicate users created\n\n## Commit Message\n```\nfeat: update seed script with role assignments\n\n- Add role field to seeded users\n- Ensure first user is ADMIN\n- Create LANDLORD and VIEWER users for testing\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:57:32.637843967Z","updated_at":"2026-01-19T16:56:35.815581792Z","closed_at":"2026-01-19T16:56:35.815581792Z","close_reason":"Seed script updated with role assignments, all reviews passed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-drp","depends_on_id":"Task-g0x","type":"blocks","created_at":"2026-01-17T18:01:14.110407542Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-drq","title":"Admin guide","description":"Write admin guide: OAuth setup, webhook configuration, troubleshooting sync failures, monitoring dashboard, security considerations, data retention policies","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:58.64535546Z","updated_at":"2026-01-20T18:27:58.64535546Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-drq","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:13.101969937Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-e3y","title":"Add requireWrite middleware to documents routes","description":"Modify server/src/routes/documents.ts to add requireWrite() middleware to POST/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/documents.test.ts to verify write permission enforcement.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:54.054120892Z","updated_at":"2026-01-21T16:29:05.138572973Z","closed_at":"2026-01-21T16:29:05.138572973Z","close_reason":"Added requireWrite middleware to all write endpoints with comprehensive role-based tests","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-e3y","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:39.038293779Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-es8","title":"Add role-based conditional rendering to Tenants page","description":"Modify client/src/pages/Tenants.tsx to use canWrite() from AuthContext to conditionally show Add/Edit/Delete buttons. Hide forms and editing capabilities for viewer role users. Ensure all action buttons and forms respect role permissions based on canWrite() check.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:59:59.156312896Z","updated_at":"2026-01-22T20:35:52.828138368Z","closed_at":"2026-01-22T20:35:52.828138368Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-es8","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:49.364688067Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-f17","title":"Duplicate detection system","description":"Implement duplicate detection: 1) Check by external ID (bankAccountId + Monzo transaction ID), 2) Fuzzy match (same amount, date ±1 day, description similarity \u003e80%)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:46.768167443Z","updated_at":"2026-01-22T16:56:41.167167818Z","closed_at":"2026-01-22T16:56:41.167167818Z","close_reason":"Implemented with Levenshtein distance algorithm, comprehensive tests, and performance optimizations","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-f17","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:39.700599863Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-fx5","title":"Add requireWrite middleware to tenants routes","description":"Modify server/src/routes/tenants.ts to add requireWrite() middleware to POST/PUT/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/tenants.test.ts to verify that users with VIEWER role are blocked from write operations while users with EDITOR or ADMIN roles can perform writes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:48.569656826Z","updated_at":"2026-01-21T16:29:05.132404291Z","closed_at":"2026-01-21T16:29:05.132404291Z","close_reason":"Added requireWrite middleware to all write endpoints with comprehensive role-based tests","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-fx5","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:35.966751848Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-g0x","title":"Add role field to User schema and migrate","description":"## Overview\nAdd a role field to the User model in Prisma schema to support role-based access control (RBAC).\n\n## Tasks\n1. Modify `prisma/schema.prisma` to add role field to User model:\n   - Add `role String @default(\"VIEWER\")` field\n   - Position after email/password fields for clarity\n   \n2. Create database migration:\n   ```bash\n   npx prisma migrate dev --name add_user_role\n   ```\n   \n3. Generate Prisma client:\n   ```bash\n   npx prisma generate\n   ```\n\n## Verification Steps\n- Check that migration file is created in `prisma/migrations/`\n- Verify migration was applied successfully\n- Test database connection still works\n- Confirm Prisma client regenerated with new field\n- Run `npm test` to ensure no existing tests broken\n\n## Commit Message\n```\nfeat: add role field to User model\n\n- Add role field with default value \"VIEWER\"\n- Create migration for schema change\n- Regenerate Prisma client\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:57:17.483966029Z","updated_at":"2026-01-17T23:11:02.153541161Z","closed_at":"2026-01-17T23:11:02.153541161Z","close_reason":"Completed - added Role enum and role field to User schema with migration","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-g0x","depends_on_id":"Task-asm","type":"blocks","created_at":"2026-01-17T18:01:13.584621627Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-g2j","title":"Historical import progress indicator","description":"Show real-time progress during initial full history import in OAuth callback. Display fetched/processed counts and completion status.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:21.114392807Z","updated_at":"2026-01-24T15:30:46.053200573Z","closed_at":"2026-01-24T15:30:46.053200573Z","close_reason":"Historical import progress tracking complete - all security issues fixed, 837 tests passing, grade 9.5/10","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-g2j","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:55.636367159Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-g2j","depends_on_id":"Task-ivt","type":"blocks","created_at":"2026-01-20T18:31:55.03921614Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-gnp","title":"Monzo API client with type definitions","description":"Create server/src/services/monzo/client.ts and server/src/services/monzo/types.ts with MonzoTransaction, MonzoWebhookPayload, and API response interfaces","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:45.082658384Z","updated_at":"2026-01-22T07:44:14.214618627Z","closed_at":"2026-01-22T07:44:14.214618627Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-gnp","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:38.520693899Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-hdl","title":"Admin notifications for failures","description":"Alert admins for: webhook delivery failures, token refresh failures, manual sync failures, signature validation failures, large pending queue (\u003e50). Use in-app notifications and email.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:36.858755614Z","updated_at":"2026-01-20T18:27:36.858755614Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-hdl","depends_on_id":"Task-hkn","type":"parent-child","created_at":"2026-01-20T18:29:03.292969754Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-hdl","depends_on_id":"Task-1is","type":"blocks","created_at":"2026-01-20T18:32:01.746732706Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-hfb","title":"Phase 4: Matching System","description":"Rule-based matching engine for automatic property and category assignment","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:25:59.819762745Z","updated_at":"2026-01-22T19:56:27.553790089Z","closed_at":"2026-01-22T19:56:27.553790089Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-hfb","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:17.048785636Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-hfb","depends_on_id":"Task-05w","type":"blocks","created_at":"2026-01-20T18:31:13.560693516Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-hkn","title":"Phase 6: Polish \u0026 Monitoring","description":"Error handling, admin notifications, audit logging, and health monitoring dashboard","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:26:01.642415817Z","updated_at":"2026-01-20T18:26:01.642415817Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-hkn","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:18.212313628Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-hkn","depends_on_id":"Task-7qr","type":"blocks","created_at":"2026-01-20T18:31:15.252662502Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-hov","title":"Frontend: Update PropertySelector to use PropertiesContext","description":"## Overview\n\nRefactor PropertySelector component to use the shared PropertiesContext instead of independently fetching properties. This eliminates duplicate API calls.\n\n## Files\n\n- Modify: `client/src/components/shared/PropertySelector.tsx`\n\n## Implementation Steps\n\n### Step 1: Review current implementation\n\nRead `client/src/components/shared/PropertySelector.tsx` to understand the current state management and fetch logic (lines 1-46).\n\nCurrent pattern:\n- Local useState for properties, loading, error\n- useEffect that calls api.get('/properties')\n- Sorting properties alphabetically\n\n### Step 2: Replace with context usage\n\nUpdate the component to use the context:\n\n```typescript\nimport React from 'react';\nimport {\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  CircularProgress,\n  SelectChangeEvent,\n} from '@mui/material';\nimport { useProperties } from '../../contexts/PropertiesContext';\nimport type { PropertySelectorProps } from '../../types/component.types';\n\nconst PropertySelector: React.FC\u003cPropertySelectorProps\u003e = ({\n  value,\n  onChange,\n  includeAllOption = true,\n  disabled = false,\n}) =\u003e {\n  // Use context instead of local state and fetch\n  const { properties, loading, error } = useProperties();\n\n  const handleChange = (event: SelectChangeEvent) =\u003e {\n    onChange(event.target.value);\n  };\n\n  return (\n    \u003cFormControl fullWidth size=\"small\"\u003e\n      \u003cInputLabel id=\"property-selector-label\"\u003eProperty\u003c/InputLabel\u003e\n      \u003cSelect\n        labelId=\"property-selector-label\"\n        id=\"property-selector\"\n        value={value}\n        label=\"Property\"\n        onChange={handleChange}\n        disabled={disabled || loading || !!error}\n      \u003e\n        {includeAllOption \u0026\u0026 (\n          \u003cMenuItem value=\"all\"\u003eAll Properties\u003c/MenuItem\u003e\n        )}\n        {!includeAllOption \u0026\u0026 value === '' \u0026\u0026 (\n          \u003cMenuItem value=\"\" disabled\u003e\n            Select a property\n          \u003c/MenuItem\u003e\n        )}\n        {loading ? (\n          \u003cMenuItem disabled\u003e\n            \u003cCircularProgress size={20} sx={{ mr: 1 }} /\u003e\n            Loading properties...\n          \u003c/MenuItem\u003e\n        ) : error ? (\n          \u003cMenuItem disabled\u003e{error}\u003c/MenuItem\u003e\n        ) : properties.length === 0 ? (\n          \u003cMenuItem disabled\u003eNo properties available\u003c/MenuItem\u003e\n        ) : (\n          properties.map((property) =\u003e (\n            \u003cMenuItem key={property.id} value={property.id}\u003e\n              {property.name} - {property.street}, {property.postcode}\n            \u003c/MenuItem\u003e\n          ))\n        )}\n      \u003c/Select\u003e\n    \u003c/FormControl\u003e\n  );\n};\n\nexport default PropertySelector;\n```\n\n### Step 3: Remove unused imports\n\nRemove these imports that are no longer needed:\n- `useState`\n- `useEffect`\n- `api` from '../../services/api'\n- `PropertiesResponse`, `Property` types (unless Property is still used in component.types)\n\n### Step 4: Test in the app\n\nStart the development server:\n```bash\nnpm run dev\n```\n\nNavigate to pages that use PropertySelector:\n- Transactions page\n- Any dialogs with PropertySelector\n\nExpected: \n- PropertySelector works correctly\n- No duplicate properties API calls in Network tab\n- All selectors show the same cached data\n\n### Step 5: Commit\n\n```bash\ngit add client/src/components/shared/PropertySelector.tsx\ngit commit -m \"refactor(frontend): use PropertiesContext in PropertySelector\n\n- Remove local state and API fetch\n- Use shared properties from context\n- Eliminates duplicate API calls\n- Maintains same functionality and UI\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. Component updated to use useProperties hook\n2. Removed local state and useEffect\n3. No TypeScript errors\n4. PropertySelector renders correctly on all pages\n5. Only ONE properties API call in Network tab (from context)\n6. Multiple PropertySelectors share the same data\n\n## Notes\n\n- Properties are still sorted alphabetically (done in context)\n- All existing props and behavior remain the same\n- This change is invisible to parent components\n- Significant performance improvement when multiple selectors exist","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:01:31.769342189Z","updated_at":"2026-01-19T16:55:36.441304313Z","closed_at":"2026-01-19T16:55:36.441304313Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-hov","depends_on_id":"Task-bg9","type":"blocks","created_at":"2026-01-17T18:02:06.262657174Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-huz","title":"Webhook health dashboard","description":"Create dashboard widget showing: total accounts, pending count, last sync time, failed accounts, webhook delivery timeline, and system health indicators","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:38.619188261Z","updated_at":"2026-01-20T18:27:38.619188261Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-huz","depends_on_id":"Task-x86","type":"blocks","created_at":"2026-01-20T18:32:02.344086823Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-huz","depends_on_id":"Task-hkn","type":"parent-child","created_at":"2026-01-20T18:29:04.485090128Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-i7n","title":"Immediate full history import in OAuth callback","description":"CRITICAL: Within OAuth callback, immediately fetch full transaction history from selected date range. Must complete within 5 minutes of OAuth completion (Monzo API restriction). Handle pagination with limit=100.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-20T18:26:17.844000563Z","updated_at":"2026-01-21T17:46:56.305197226Z","closed_at":"2026-01-21T17:46:56.305197226Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-i7n","depends_on_id":"Task-dep","type":"blocks","created_at":"2026-01-20T18:31:26.413669212Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-i7n","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:25.556750268Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-ivt","title":"OAuth connection flow with range selection","description":"Frontend component for 'Connect New Account' with historical date range selector (default 90 days, max 5 years). Handle OAuth redirect and callback.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:20.302751313Z","updated_at":"2026-01-23T18:46:39.64999575Z","closed_at":"2026-01-23T18:46:39.64999575Z","close_reason":"OAuth connection flow with range selection was already implemented in Task-n4r. The BankAccounts page includes a 'Connect New Account' dialog with historical date range selector (30 days to 5 years, default 90 days) that calls bankService.connectMonzo() to initiate OAuth flow. Dialog handles loading states, error handling, and OAuth callback success/error messages via URL query parameters.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-ivt","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:55.038386455Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-ivt","depends_on_id":"Task-n4r","type":"blocks","created_at":"2026-01-20T18:31:54.461611381Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-j3y","title":"Phase 2: Webhook Infrastructure","description":"Webhook endpoint, signature verification, registration/deletion, and idempotency handling","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:25:58.163393278Z","updated_at":"2026-01-21T20:49:12.307908309Z","closed_at":"2026-01-21T20:49:12.307908309Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-j3y","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:15.822371783Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-j3y","depends_on_id":"Task-6gi","type":"blocks","created_at":"2026-01-20T18:31:11.863044411Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-kcv","title":"Phase 7: Testing \u0026 Documentation","description":"Comprehensive test suite, integration tests, E2E tests, and user documentation","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-20T18:26:02.466296035Z","updated_at":"2026-01-20T18:26:02.466296035Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-kcv","depends_on_id":"Task-hkn","type":"blocks","created_at":"2026-01-20T18:31:19.166626088Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-rli","type":"parent-child","created_at":"2026-01-20T18:28:18.797188852Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-6gi","type":"blocks","created_at":"2026-01-20T18:31:16.085524431Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-j3y","type":"blocks","created_at":"2026-01-20T18:31:16.654901209Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-05w","type":"blocks","created_at":"2026-01-20T18:31:17.330430524Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-hfb","type":"blocks","created_at":"2026-01-20T18:31:17.938222398Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kcv","depends_on_id":"Task-7qr","type":"blocks","created_at":"2026-01-20T18:31:18.53544306Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-kez","title":"Token encryption service implementation","description":"Implement AES-256-GCM encryption service for OAuth tokens with unique IV per token. Store encryption key in environment variable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:16.14164872Z","updated_at":"2026-01-21T07:44:19.833301024Z","closed_at":"2026-01-21T07:44:19.833301024Z","close_reason":"Implemented AES-256-GCM encryption service with comprehensive tests, approved by code quality review","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-kez","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:24.377031239Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-kez","depends_on_id":"Task-22x","type":"blocks","created_at":"2026-01-20T18:31:24.611123443Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-kpv","title":"Implement User Management","description":"## Overview\nAdd a Settings/User Management page with password change functionality and user CRUD (create, list, delete users).\n\n## Files to Create/Modify\n- `server/src/routes/users.ts` - New file for user CRUD endpoints\n- `server/src/routes/auth.ts` - Add password change endpoint\n- `server/src/app.ts` - Register users router\n- `client/src/pages/Settings.tsx` - New file for settings page\n- `client/src/services/api/users.service.ts` - New file for users API service\n- `client/src/types/api.types.ts` - Add user management types\n- `client/src/App.tsx` - Add settings route\n- Navigation component - Add settings link\n\n## Implementation Steps\n\n### Step 1: Create server/src/routes/users.ts\n```typescript\nimport { Router } from 'express';\nimport { requireAuth } from '../middleware/auth.js';\nimport prisma from '../db/client.js';\nimport bcrypt from 'bcrypt';\nimport { z } from 'zod';\n\nconst router = Router();\n\n// GET /api/users - List all users\nrouter.get('/', requireAuth, async (req, res) =\u003e {\n  const users = await prisma.user.findMany({\n    select: { id: true, email: true, createdAt: true },\n  });\n  return res.json({ success: true, users });\n});\n\n// POST /api/users - Create new user\nrouter.post('/', requireAuth, async (req, res) =\u003e {\n  const schema = z.object({\n    email: z.string().email(),\n    password: z.string().min(8),\n  });\n  const result = schema.safeParse(req.body);\n  if (!result.success) {\n    return res.status(400).json({ success: false, error: result.error.issues[0].message });\n  }\n  const { email, password } = result.data;\n  const existing = await prisma.user.findUnique({ where: { email } });\n  if (existing) {\n    return res.status(400).json({ success: false, error: 'Email already in use' });\n  }\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const user = await prisma.user.create({\n    data: { email, password: hashedPassword },\n    select: { id: true, email: true, createdAt: true },\n  });\n  return res.status(201).json({ success: true, user });\n});\n\n// DELETE /api/users/:id - Delete user\nrouter.delete('/:id', requireAuth, async (req, res) =\u003e {\n  const { id } = req.params;\n  // Prevent self-delete\n  if (req.session.userId === id) {\n    return res.status(400).json({ success: false, error: 'Cannot delete yourself' });\n  }\n  const user = await prisma.user.findUnique({ where: { id } });\n  if (!user) {\n    return res.status(404).json({ success: false, error: 'User not found' });\n  }\n  await prisma.user.delete({ where: { id } });\n  return res.json({ success: true, message: 'User deleted' });\n});\n\nexport default router;\n```\n\n### Step 2: Add password change to auth.ts\nAdd endpoint:\n```typescript\n// PUT /api/auth/password - Change password\nrouter.put('/password', requireAuth, async (req, res) =\u003e {\n  const schema = z.object({\n    currentPassword: z.string(),\n    newPassword: z.string().min(8),\n  });\n  const result = schema.safeParse(req.body);\n  if (!result.success) {\n    return res.status(400).json({ success: false, error: result.error.issues[0].message });\n  }\n  const { currentPassword, newPassword } = result.data;\n  const user = await prisma.user.findUnique({ where: { id: req.session.userId } });\n  if (!user) {\n    return res.status(404).json({ success: false, error: 'User not found' });\n  }\n  const valid = await bcrypt.compare(currentPassword, user.password);\n  if (!valid) {\n    return res.status(400).json({ success: false, error: 'Current password is incorrect' });\n  }\n  const hashedPassword = await bcrypt.hash(newPassword, 10);\n  await prisma.user.update({\n    where: { id: req.session.userId },\n    data: { password: hashedPassword },\n  });\n  return res.json({ success: true, message: 'Password updated' });\n});\n```\n\n### Step 3: Register users router in app.ts\nAdd:\n```typescript\nimport usersRouter from './routes/users.js';\n// ...\napp.use('/api/users', usersRouter);\n```\n\n### Step 4: Create client/src/services/api/users.service.ts\n```typescript\nimport { api } from '../api';\n\nexport interface UserListItem {\n  id: string;\n  email: string;\n  createdAt: string;\n}\n\nexport const usersService = {\n  async getUsers(): Promise\u003cUserListItem[]\u003e {\n    const response = await api.get('/users');\n    return response.data.users;\n  },\n  async createUser(email: string, password: string): Promise\u003cUserListItem\u003e {\n    const response = await api.post('/users', { email, password });\n    return response.data.user;\n  },\n  async deleteUser(id: string): Promise\u003cvoid\u003e {\n    await api.delete(`/users/${id}`);\n  },\n  async changePassword(currentPassword: string, newPassword: string): Promise\u003cvoid\u003e {\n    await api.put('/auth/password', { currentPassword, newPassword });\n  },\n};\n```\n\n### Step 5: Create client/src/pages/Settings.tsx\nFull page with two sections:\n1. Change Password form (current, new, confirm)\n2. User Management table (list, create, delete)\n\n### Step 6: Add route in App.tsx\n```typescript\nimport { Settings } from './pages/Settings';\n// In routes:\n\u003cRoute path=\"/settings\" element={\u003cSettings /\u003e} /\u003e\n```\n\n### Step 7: Add navigation link\nFind the sidebar/nav component and add Settings link with icon (Settings or Person icon)\n\n### Step 8: Verify\nRun: `npm run dev`\n- Navigate to Settings page\n- Change password\n- Create a new user\n- Delete a user (not yourself)\n\n### Step 9: Commit\n```bash\ngit add server/src/routes/users.ts server/src/routes/auth.ts server/src/app.ts client/src/pages/Settings.tsx client/src/services/api/users.service.ts client/src/App.tsx\ngit commit -m \"feat: add user management and password change functionality\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:24:43.642799242Z","updated_at":"2026-01-15T18:30:58.729011714Z","closed_at":"2026-01-15T18:30:58.729011714Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-kpv","depends_on_id":"Task-860","type":"blocks","created_at":"2026-01-15T17:25:06.197349495Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-l3q","title":"BankTransaction storage","description":"Create BankTransaction records from processed Monzo transactions. Store all fields including counterparty, merchant, reference, and metadata.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:47.630717368Z","updated_at":"2026-01-22T17:14:29.825142502Z","closed_at":"2026-01-22T17:14:29.825142502Z","close_reason":"Already implemented in Task-2ih transaction processor - all fields stored including counterparty, merchant, reference, category","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-l3q","depends_on_id":"Task-f17","type":"blocks","created_at":"2026-01-20T18:31:40.460161864Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-l3q","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:40.300118189Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-l3q","depends_on_id":"Task-bx3","type":"blocks","created_at":"2026-01-20T18:31:39.843171491Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-lt9","title":"Rule evaluation engine","description":"Implement rule matching engine with AND/OR logic, pattern matching (contains, equals, startsWith, endsWith, comparisons), and field accumulation until all fields (propertyId, type, category) are set","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:02.39563484Z","updated_at":"2026-01-22T17:56:28.864068106Z","closed_at":"2026-01-22T17:56:28.864068106Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-lt9","depends_on_id":"Task-hfb","type":"parent-child","created_at":"2026-01-20T18:28:47.556603126Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-m3b","title":"Webhook deletion on account disconnect","description":"When disconnecting bank account, call DELETE /webhooks/:webhook_id to unregister webhook from Monzo API.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:31.716463469Z","updated_at":"2026-01-21T20:49:00.433619384Z","closed_at":"2026-01-21T20:49:00.433619384Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-m3b","depends_on_id":"Task-s6w","type":"blocks","created_at":"2026-01-20T18:31:33.114207732Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-m3b","depends_on_id":"Task-j3y","type":"parent-child","created_at":"2026-01-20T18:28:33.24316078Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-m5d","title":"SyncLog creation and management","description":"Create SyncLog records for all sync operations (webhook, manual, initial). Track counts, status, errors, and completion times.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:49.345578954Z","updated_at":"2026-01-22T17:26:06.215514483Z","closed_at":"2026-01-22T17:26:06.215514483Z","close_reason":"Implemented complete SyncLog tracking for webhook, manual, and initial sync operations with transactionsSkipped field","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-m5d","depends_on_id":"Task-05w","type":"parent-child","created_at":"2026-01-20T18:28:41.532619485Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-m5d","depends_on_id":"Task-l3q","type":"blocks","created_at":"2026-01-20T18:31:41.031922177Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-mdy","title":"Calendar/Events Page with react-big-calendar","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:19.537389851Z","updated_at":"2026-01-14T14:29:20.403360683Z","closed_at":"2026-01-14T14:29:20.403360683Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-mdy","depends_on_id":"Task-85a","type":"blocks","created_at":"2026-01-13T11:16:38.116722946Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-mdy","depends_on_id":"Task-0ur","type":"blocks","created_at":"2026-01-13T11:16:38.633836981Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-mdy","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:16:39.166914891Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-mdy","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:37.586911825Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-mju","title":"Backend: Update lease validation schema for array property_id","description":"## Overview\n\nUpdate the lease validation schema to accept property_id as either a single string or an array of strings. This is the foundation for batch lease querying.\n\n## Files\n\n- Modify: `shared/validation/lease.validation.js`\n\n## Implementation Steps\n\n### Step 1: Review current schema\n\nRead `shared/validation/lease.validation.js` to understand the current `LeaseQueryParamsSchema`.\n\nCurrent structure likely has:\n```javascript\nproperty_id: z.string().uuid().optional()\n```\n\n### Step 2: Update the schema\n\nModify the `LeaseQueryParamsSchema` to accept both string and string array:\n\n```javascript\nproperty_id: z.union([\n  z.string().uuid(),\n  z.array(z.string().uuid())\n]).optional()\n```\n\nThis allows:\n- Single ID: `?property_id=abc-123`\n- Multiple IDs: `?property_id=abc-123\u0026property_id=def-456`\n\n### Step 3: Verify schema syntax\n\nRun the TypeScript/JavaScript type checker:\n```bash\nnpm run lint\n```\n\nExpected: No errors in validation file\n\n### Step 4: Commit\n\n```bash\ngit add shared/validation/lease.validation.js\ngit commit -m \"feat(validation): accept array of property IDs in lease query params\n\n- Update LeaseQueryParamsSchema to accept string | string[]\n- Enables batch lease querying by multiple property IDs\n- Backward compatible with single property_id\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. File updated with union type\n2. No linting errors\n3. Schema accepts both single and array values\n\n## Notes\n\n- This change is backward compatible\n- Express automatically converts repeated query params to arrays\n- Zod union type handles both cases gracefully","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-17T18:01:17.072229824Z","updated_at":"2026-01-17T18:28:52.430487318Z","closed_at":"2026-01-17T18:28:52.430487318Z","close_reason":"Closed","created_by":"Alexander Pezarro"}
{"id":"Task-mom","title":"Create admin-only Users management page","description":"Create client/src/pages/Users.tsx with complete implementation.\n\nFeatures to implement:\n- List all users in a MUI Table showing username, email, role\n- Create new users with Dialog form including username, email, password, and role selection (dropdown for ADMIN/LANDLORD/VIEWER)\n- Change user roles with MUI Select dropdown inline in the table\n- Delete users with confirmation dialog\n- Complete component code using MUI components (Table, Dialog, Select, Button, TextField)\n- API calls to /api/users endpoints (GET, POST, PUT, DELETE)\n- Only accessible to ADMIN users (use isAdmin() check from AuthContext)\n- Show loading states and error handling using ToastContext\n- Form validation for user creation\n\nImplementation details:\n- Import required MUI components and hooks\n- Use useState for dialog state and user list\n- Use useEffect to fetch users on mount\n- Implement handleCreateUser, handleUpdateRole, handleDeleteUser\n- Use api service from client/src/services/api.ts\n- Add appropriate TypeScript types from shared/types\n\nCommit message: feat: add Users management page for admins","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:59:53.45730038Z","updated_at":"2026-01-18T22:47:16.865424107Z","closed_at":"2026-01-18T22:47:16.865424107Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-mom","depends_on_id":"Task-cmd","type":"blocks","created_at":"2026-01-17T18:01:52.957498328Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-mom","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:53.606902335Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-mx3","title":"Basic BankAccount CRUD endpoints","description":"Implement GET /api/bank/accounts, GET /api/bank/accounts/:id, PATCH /api/bank/accounts/:id, DELETE /api/bank/accounts/:id with admin authentication","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:18.698091186Z","updated_at":"2026-01-21T17:46:56.309308014Z","closed_at":"2026-01-21T17:46:56.309308014Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-mx3","depends_on_id":"Task-6gi","type":"parent-child","created_at":"2026-01-20T18:28:26.165996008Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-mx3","depends_on_id":"Task-22x","type":"blocks","created_at":"2026-01-20T18:31:26.999043517Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-n4r","title":"Bank accounts management page","description":"Create /admin/bank-accounts page with BankAccountsList component showing cards with status, pending count, webhook status, and settings","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:19.453361998Z","updated_at":"2026-01-23T18:46:05.30910924Z","closed_at":"2026-01-23T18:46:05.30910924Z","close_reason":"Implemented bank accounts management page with all required features: page route, BankAccountsList component with cards showing account info, status, pending count, webhook status, and settings. Includes Connect New Account button with range selector. All spec requirements met, code quality issues resolved, comprehensive test coverage added.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-n4r","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:54.451399619Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-ob7","title":"Documents/File Upload API with Multer","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:48:09.356011401Z","updated_at":"2026-01-13T15:48:11.837721175Z","closed_at":"2026-01-13T15:48:11.837721175Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-ob7","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:55.441424751Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-ob7","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:55.992187813Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-ob7","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:56.508556765Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-ob7","depends_on_id":"Task-4fz","type":"blocks","created_at":"2026-01-13T11:15:57.060524581Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-onm","title":"Add role support and permission helpers to AuthContext","description":"## Overview\nAdd role support to AuthContext to enable permission-based UI rendering and access control in the frontend.\n\n## Implementation\n\n### Modify client/src/contexts/AuthContext.tsx\n\n1. Update user state interface to include role:\n```typescript\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  role: 'admin' | 'landlord' | 'tenant';\n}\n```\n\n2. Fetch role from /api/auth/me endpoint when checking authentication\n\n3. Add permission helper functions to the context:\n```typescript\nconst isAdmin = () =\u003e user?.role === 'admin';\nconst isLandlord = () =\u003e user?.role === 'landlord' || user?.role === 'admin';\nconst canWrite = () =\u003e user?.role === 'admin' || user?.role === 'landlord';\n```\n\n4. Export these helpers in the context value\n\n## Verification\n\n- Test login with different user roles\n- Verify role is correctly fetched from /api/auth/me\n- Test helper functions return correct values\n- Check that role persists across page refreshes\n\n## Commit Message\n```\nfeat: add role support to AuthContext\n\nAdd role field to user state and fetch from /api/auth/me endpoint.\nInclude permission helper functions: isAdmin(), isLandlord(), canWrite().\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:00:28.883828019Z","updated_at":"2026-01-19T16:28:52.357637311Z","closed_at":"2026-01-19T16:28:52.357637311Z","close_reason":"AuthContext role support implementation complete with all code quality issues resolved","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-onm","depends_on_id":"Task-0b8","type":"blocks","created_at":"2026-01-17T18:01:48.010634378Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-ovu","title":"Frontend: Create PropertiesContext for shared caching","description":"## Overview\n\nCreate a PropertiesContext that fetches and caches properties data, sharing it across all components. Includes provider, hook, and refetch functionality.\n\n## Files\n\n- Create: `client/src/contexts/PropertiesContext.tsx`\n\n## Implementation Steps\n\n### Step 1: Create the context file\n\nCreate `client/src/contexts/PropertiesContext.tsx` with the following implementation:\n\n```typescript\nimport React, { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';\nimport { propertiesService } from '../services/api/properties.service';\nimport type { Property } from '../types/api.types';\nimport { ApiError } from '../types/api.types';\n\ninterface PropertiesContextValue {\n  properties: Property[];\n  loading: boolean;\n  error: string | null;\n  refetch: () =\u003e Promise\u003cvoid\u003e;\n}\n\nconst PropertiesContext = createContext\u003cPropertiesContextValue | undefined\u003e(undefined);\n\ninterface PropertiesProviderProps {\n  children: ReactNode;\n}\n\nexport const PropertiesProvider: React.FC\u003cPropertiesProviderProps\u003e = ({ children }) =\u003e {\n  const [properties, setProperties] = useState\u003cProperty[]\u003e([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n\n  const fetchProperties = useCallback(async () =\u003e {\n    try {\n      setLoading(true);\n      setError(null);\n      const fetchedProperties = await propertiesService.getProperties();\n      \n      // Sort properties alphabetically by name\n      const sortedProperties = fetchedProperties.sort((a, b) =\u003e\n        a.name.localeCompare(b.name)\n      );\n      \n      setProperties(sortedProperties);\n    } catch (err) {\n      console.error('Error fetching properties:', err);\n      const errorMessage = err instanceof ApiError ? err.message : 'Failed to load properties';\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() =\u003e {\n    fetchProperties();\n  }, [fetchProperties]);\n\n  const value: PropertiesContextValue = {\n    properties,\n    loading,\n    error,\n    refetch: fetchProperties,\n  };\n\n  return (\n    \u003cPropertiesContext.Provider value={value}\u003e\n      {children}\n    \u003c/PropertiesContext.Provider\u003e\n  );\n};\n\nexport const useProperties = (): PropertiesContextValue =\u003e {\n  const context = useContext(PropertiesContext);\n  if (context === undefined) {\n    throw new Error('useProperties must be used within a PropertiesProvider');\n  }\n  return context;\n};\n```\n\n### Step 2: Verify TypeScript compilation\n\n```bash\nnpm run build\n```\n\nExpected: No TypeScript errors\n\n### Step 3: Commit\n\n```bash\ngit add client/src/contexts/PropertiesContext.tsx\ngit commit -m \"feat(frontend): add PropertiesContext for shared property caching\n\n- Create PropertiesProvider with properties state\n- Add useProperties hook for consuming components\n- Include refetch method for cache invalidation\n- Fetches and sorts properties alphabetically\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. File created at correct path\n2. TypeScript compiles without errors\n3. Context provides properties, loading, error, and refetch\n4. Hook throws error if used outside provider\n\n## Notes\n\n- Context fetches on mount automatically\n- refetch() can be called after mutations to update cache\n- Sorting matches existing PropertySelector behavior\n- Error handling mirrors existing patterns in the app","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T18:01:30.369250279Z","updated_at":"2026-01-17T18:46:37.919607638Z","closed_at":"2026-01-17T18:46:37.919607638Z","close_reason":"Closed","created_by":"Alexander Pezarro"}
{"id":"Task-pde","title":"Add role-based conditional rendering to Transactions page","description":"Modify client/src/pages/Transactions.tsx to use canWrite() for conditional rendering. Hide Add Transaction button and edit/delete actions for users with viewer role. Follow the pattern established in Properties and Tenants pages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:59:56.027418445Z","updated_at":"2026-01-22T20:24:48.725638815Z","closed_at":"2026-01-22T20:24:48.725638815Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-pde","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:50.765792903Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-peo","title":"Add role-based conditional rendering to Leases page","description":"Modify client/src/pages/Leases.tsx to use canWrite() from AuthContext to conditionally show Add/Edit/Delete buttons. Hide forms and editing capabilities for viewer role users. Ensure all action buttons, forms, and lease management features respect role permissions based on canWrite() check.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T18:00:05.346547265Z","updated_at":"2026-01-22T20:49:50.562931535Z","closed_at":"2026-01-22T20:49:50.562931535Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-peo","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:50.010463039Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-pmy","title":"Properties List/Detail Page with CRUD Operations","description":"Create a comprehensive Properties page component with the following features:\n\n**List View:**\n- Material-UI DataGrid or Card-based layout for displaying all properties\n- Search functionality (filter by name, address, postcode)\n- Filter by property status (vacant, on_market, rented, maintenance, other)\n- Filter by property type (house, apartment, condo, commercial, other)\n- Status badges with appropriate colors\n- Sort by name, purchase date, status\n- Click on property card/row to navigate to detail view\n- \"Add Property\" button to create new property\n\n**Property Cards (if using card layout):**\n- Property name and address\n- Status badge with color coding\n- Property type\n- Quick stats (current tenant, monthly rent if applicable)\n- Edit and Delete action buttons\n\n**Create/Edit Property Form:**\n- React Hook Form with Zod validation\n- Fields: name, address (street, city, county, postcode), property_type, purchase_date, purchase_price, status, notes\n- UK postcode validation\n- Material-UI form components\n- Save and Cancel buttons\n- Modal or slide-out drawer for form\n\n**Property Detail View:**\n- Property information section with edit capability\n- Tabs for different sections:\n  1. Overview: Full property details, map/location (if possible), notes\n  2. Leases: Current and past leases with tenant information\n     - Show lease dates, monthly rent, security deposit\n     - Click to view tenant details\n     - \"Add Lease\" button\n  3. Transactions: Financial history for this property\n     - Filterable transaction list (income/expense, category, date range)\n     - Summary stats (total income, total expenses, net)\n     - Click to view/edit transaction\n     - \"Add Transaction\" button\n  4. Events: Scheduled and completed events for this property\n     - Calendar or list view\n     - Filter by event type and completion status\n     - Click to view/edit event\n     - \"Schedule Event\" button\n\n**CRUD Operations:**\n- GET /api/properties - Fetch all properties\n- GET /api/properties/:id - Fetch single property with related data\n- POST /api/properties - Create new property\n- PUT /api/properties/:id - Update property\n- DELETE /api/properties/:id - Delete property (with confirmation dialog)\n\n**API Integration:**\n- Use Axios for API calls\n- Create API service functions in /client/src/services/propertiesService.ts\n- Handle loading states, error states, and success notifications\n- Use Material-UI Snackbar for toast notifications\n\n**State Management:**\n- React hooks (useState, useEffect) for local state\n- Consider React Query or SWR for data fetching and caching (optional)\n\n**Responsive Design:**\n- Mobile-friendly layout\n- Collapsible sidebar navigation\n- Touch-friendly buttons and forms\n\n**File Location:**\n- /client/src/pages/Properties.tsx - Main properties page\n- /client/src/components/PropertyCard.tsx - Property card component\n- /client/src/components/PropertyForm.tsx - Create/Edit form\n- /client/src/components/PropertyDetail.tsx - Detail view component\n- /client/src/services/propertiesService.ts - API service functions\n\n**Dependencies:**\n- @mui/material\n- @mui/x-data-grid (if using DataGrid)\n- react-hook-form\n- zod\n- axios\n- react-router-dom\n\n**Testing:**\n- Test CRUD operations with existing Properties API\n- Verify validation works correctly\n- Test filtering and search functionality\n- Ensure responsive layout on mobile devices\n\n**Notes:**\n- Reuse shared components where possible (ConfirmDialog, DateRangePicker, PropertySelector)\n- Follow Material-UI design patterns\n- Ensure accessibility (ARIA labels, keyboard navigation)\n- Display related data (leases, transactions, events) from their respective APIs\n- Implement proper error handling and user feedback","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:54.621626267Z","updated_at":"2026-01-14T18:20:18.590257908Z","closed_at":"2026-01-14T18:20:18.590257908Z","close_reason":"Completed in commit b12c333 - Properties List and Detail pages implemented with full CRUD operations","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-pmy","depends_on_id":"Task-4q5","type":"blocks","created_at":"2026-01-13T11:16:31.592749955Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-pmy","depends_on_id":"Task-0ur","type":"blocks","created_at":"2026-01-13T11:16:32.143525087Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-pmy","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:29.404106804Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-pmy","depends_on_id":"Task-85a","type":"blocks","created_at":"2026-01-13T11:16:29.959366016Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-pmy","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:16:30.484521975Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-pmy","depends_on_id":"Task-srp","type":"blocks","created_at":"2026-01-13T11:16:31.054887989Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-qyc","title":"Add requireWrite middleware to transactions routes","description":"Modify server/src/routes/transactions.ts to add requireWrite() middleware to POST/PUT/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/transactions.test.ts to verify write permission enforcement.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:41.681857866Z","updated_at":"2026-01-19T17:01:44.232742247Z","closed_at":"2026-01-19T17:01:44.232742247Z","close_reason":"Implemented as specified. Note: GET routes intentionally left without auth per spec - this matches existing codebase pattern. If authentication needed on reads, that would be a separate architectural decision/bead.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-qyc","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:37.561260646Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-qyw","title":"Add role-based conditional rendering to Events page","description":"Modify client/src/pages/Events.tsx to use canWrite() for conditional rendering. Hide Add Event button and edit/delete actions for users with viewer role. Follow the pattern established in Properties and Tenants pages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T18:00:02.204578465Z","updated_at":"2026-01-22T20:43:35.631402007Z","closed_at":"2026-01-22T20:43:35.631402007Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-qyw","depends_on_id":"Task-onm","type":"blocks","created_at":"2026-01-17T18:01:51.506370147Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-rli","title":"Bank Account Integration (Monzo)","description":"Full bank account integration with Monzo API including OAuth, webhooks, transaction import, and intelligent matching system","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-20T18:25:56.458027144Z","updated_at":"2026-01-20T18:25:56.458027144Z","created_by":"Alexander Pezarro"}
{"id":"Task-s6w","title":"Webhook endpoint implementation","description":"Create POST /api/bank/webhooks/monzo endpoint to receive transaction.created events from Monzo. Public endpoint with signature validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:26:29.179645256Z","updated_at":"2026-01-21T18:15:53.701586985Z","closed_at":"2026-01-21T18:15:53.701586985Z","close_reason":"Implemented POST /api/bank/webhooks/monzo endpoint with payload validation, SyncLog tracking, idempotent transaction creation, and 11 passing tests. Spec compliance and code quality reviews approved. TODO added for HMAC verification (Task-7im).","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-s6w","depends_on_id":"Task-j3y","type":"parent-child","created_at":"2026-01-20T18:28:31.454781247Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-s7o","title":"Add Users menu item and route configuration","description":"Add routing and navigation for the Users management page.\n\nTasks:\n1. Add route configuration in client/src/App.tsx (or router config file):\n   - Path: /users\n   - Component: Users (lazy imported)\n   - Protected route requiring authentication\n\n2. Add \"Users\" menu item in navigation component:\n   - Find the main navigation component (likely in client/src/components/ or within App.tsx)\n   - Add conditional rendering: only show if isAdmin() returns true\n   - Use AuthContext to check user role\n   - Add appropriate MUI icon (e.g., People or Group icon)\n   - Position after other admin-specific items or in settings section\n\n3. Implementation details:\n   - Import Users component (lazy load if using React.lazy)\n   - Import isAdmin helper from AuthContext\n   - Add menu item with proper styling consistent with existing navigation\n   - Ensure navigation highlights when on /users route\n   - Add TypeScript types as needed\n\n4. Verification steps:\n   - Login as admin user: Users menu item should be visible\n   - Login as viewer/landlord: Users menu item should NOT be visible\n   - Navigate to /users as admin: page loads correctly\n   - Direct navigation to /users as non-admin: should redirect or show error\n\nCommit message: feat: add Users navigation for admins","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T18:00:10.17444326Z","updated_at":"2026-01-22T21:05:52.087800197Z","closed_at":"2026-01-22T21:05:52.087800197Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-s7o","depends_on_id":"Task-mom","type":"blocks","created_at":"2026-01-17T18:01:54.277944021Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-srp","title":"Leases CRUD API with endpoints, filtering by property and status, validation, and relationship management with tenants and properties","description":"Implement Leases CRUD API following the established patterns from Properties and Tenants APIs.\n\nFILE LOCATION:\n- server/src/routes/leases.ts (create new file)\n\nENDPOINTS TO IMPLEMENT:\n\n1. GET /api/leases\n   - Query parameters: property_id (optional), tenant_id (optional), status (optional: Draft, Active, Expired, Terminated)\n   - Validate query params using LeaseQueryParamsSchema (create in lease.validation.ts)\n   - Return filtered list of leases with property and tenant relationships included\n   - Order by startDate desc\n   - Response: { success: true, leases: Lease[] }\n\n2. GET /api/leases/:id\n   - Validate UUID format\n   - Include property and tenant relations in response\n   - Return 404 if not found\n   - Response: { success: true, lease: Lease }\n\n3. POST /api/leases (requires auth)\n   - Validate with CreateLeaseSchema\n   - Business logic validations:\n     * Check property exists and is not deleted\n     * Check tenant exists and is not Former status\n     * Validate no overlapping ACTIVE leases for the same property (only check Active status, not Draft/Expired/Terminated)\n     * Overlap check: new lease's date range overlaps if (startDate \u003c= existing.endDate OR existing.endDate is null) AND (endDate \u003e= existing.startDate OR new endDate is null)\n   - Create lease in database\n   - Return 201 status\n   - Response: { success: true, lease: Lease }\n\n4. PUT /api/leases/:id (requires auth)\n   - Validate UUID format and UpdateLeaseSchema\n   - Check lease exists\n   - If property or tenant changed, validate they exist\n   - If dates changed, validate no overlapping ACTIVE leases (exclude current lease from overlap check)\n   - Update lease\n   - Response: { success: true, lease: Lease }\n\n5. DELETE /api/leases/:id (requires auth)\n   - Validate UUID format\n   - Check lease exists\n   - Soft delete: set status to 'Terminated'\n   - Response: { success: true, lease: Lease }\n\nVALIDATION SCHEMA TO CREATE:\nAdd to shared/validation/lease.validation.ts:\n- LeaseQueryParamsSchema with optional property_id (uuid), tenant_id (uuid), and status (LeaseStatusSchema enum) filters\n\nPATTERNS TO FOLLOW:\n- Use requireAuth middleware from '../middleware/auth.js'\n- Import prisma from '../db/client.js'\n- Import schemas from '../../../shared/validation/lease.validation.js'\n- Standard error responses with 400/404/500 status codes\n- Use z.string().uuid() for ID validation\n- Include try-catch blocks with console.error logging\n- Use prisma includes: { property: true, tenant: true }\n\nERROR HANDLING:\n- 400: Validation errors (invalid input, date conflicts, overlapping leases with clear message \"Cannot create lease: overlapping active lease exists for this property\")\n- 404: Lease/property/tenant not found\n- 500: Server errors\n\nTESTS:\nCreate server/src/routes/__tests__/leases.test.ts following patterns from properties.test.ts and tenants.test.ts with test cases for:\n- List leases with filters (by property, tenant, status)\n- Get single lease with relations\n- Create lease with validation\n- Prevent overlapping ACTIVE leases (should fail)\n- Allow Draft/Expired leases on same property (should succeed)\n- Update lease\n- Delete (soft delete to Terminated)\n- Error cases (not found, invalid IDs, unauthorized, Former tenant)\n\nREGISTRATION:\nAdd to server/src/server.ts:\nimport leasesRoutes from './routes/leases.js';\napp.use('/api/leases', leasesRoutes);","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-13T10:47:38.965701308Z","updated_at":"2026-01-13T18:03:53.323572129Z","closed_at":"2026-01-13T18:03:53.323572129Z","close_reason":"Implemented Leases CRUD API with all endpoints, filtering, validation, overlap detection, and comprehensive tests. All tests passing.","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-srp","depends_on_id":"Task-b30","type":"blocks","created_at":"2026-01-13T11:15:49.377964275Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-srp","depends_on_id":"Task-4l5","type":"blocks","created_at":"2026-01-13T11:15:49.87140135Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-srp","depends_on_id":"Task-d3h","type":"blocks","created_at":"2026-01-13T11:15:50.362280751Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-srp","depends_on_id":"Task-221","type":"blocks","created_at":"2026-01-13T11:15:48.383187419Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-srp","depends_on_id":"Task-0m9","type":"blocks","created_at":"2026-01-13T11:15:48.87967505Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-tmr","title":"Project setup \u0026 tooling configuration","description":"## Overview\nInitialize the landlord management system project structure with TypeScript, Node.js backend, React frontend, and development tooling.\n\n## Files\n- Create: `package.json`\n- Create: `tsconfig.json`\n- Create: `server/tsconfig.json`\n- Create: `client/tsconfig.json`\n- Create: `server/src/server.ts`\n- Create: `client/src/main.tsx`\n- Create: `client/src/App.tsx`\n- Create: `client/vite.config.ts`\n- Create: `client/index.html`\n- Create: `.gitignore`\n- Create: `.env.example`\n\n## Implementation Steps\n\n### Step 1: Initialize project\n\n```bash\n# Create project structure\nmkdir -p server/src/{routes,services,middleware,utils}\nmkdir -p client/src/{components,pages,hooks,services,types}\nmkdir -p shared/{types,validation}\nmkdir -p data uploads docs prisma\n```\n\n### Step 2: Create root package.json with all dependencies\n\n### Step 3: Create client package.json\n\n### Step 4: Create TypeScript configs for root, server, and client\n\n### Step 5: Create Vite config with proxy to backend\n\n### Step 6: Create basic server entry with Express, helmet, rate limiting\n\n### Step 7: Create basic React app with health check\n\n### Step 8: Create .gitignore and .env.example\n\n### Step 9: Install dependencies and test\n\n```bash\nnpm install\ncd client \u0026\u0026 npm install \u0026\u0026 cd ..\nnpm run dev\n```\n\nExpected: Both servers start successfully. Visit http://localhost:5173 and see \"Server status: ok\"\n\n### Step 10: Commit\n\n```bash\ngit add .\ngit commit -m \"feat: initial project setup with TypeScript, Express, and React\"\n```\n\n## Verification\n\n- [ ] `npm run dev` starts both backend (port 3000) and frontend (port 5173)\n- [ ] Frontend displays \"Server status: ok\"\n- [ ] `curl http://localhost:3000/api/health` returns JSON with status \"ok\"\n- [ ] TypeScript compiles without errors\n- [ ] All directories exist as per project structure\n\n## Notes\n\n- This is the foundation bead that all others depend on\n- The proxy configuration in Vite allows frontend to call `/api` endpoints\n- Rate limiting is set conservatively (100 requests per 15 minutes)\n- Session secret should be changed in production","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-13T10:52:04.491817986Z","updated_at":"2026-01-13T12:29:06.523788612Z","closed_at":"2026-01-13T12:29:06.523788612Z","close_reason":"Project setup complete. All verification requirements passed. Code quality: Approved with reservations - production concerns (CORS, graceful shutdown, session store, error handling) should be addressed in future beads before deployment.","created_by":"Alexander Pezarro"}
{"id":"Task-tn1","title":"Integration tests for webhook flow","description":"Test complete webhook flow: receive → signature verify → process → duplicate detection → rule matching → Transaction/PendingTransaction creation. Mock Monzo webhook payloads.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:54.27235489Z","updated_at":"2026-01-20T18:27:54.27235489Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-tn1","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:10.172570766Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-u0c","title":"E2E tests for complete user journey","description":"E2E tests: connect account → immediate import → receive webhook → auto-match → review pending → approve → verify in Transaction list. Test error recovery scenarios.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:56.899723038Z","updated_at":"2026-01-20T18:27:56.899723038Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-u0c","depends_on_id":"Task-kcv","type":"parent-child","created_at":"2026-01-20T18:29:11.930012758Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-u0c","depends_on_id":"Task-3zz","type":"blocks","created_at":"2026-01-20T18:32:09.286260131Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-u8t","title":"Add requireWrite middleware to events routes","description":"Modify server/src/routes/events.ts to add requireWrite() middleware to POST/PUT/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/events.test.ts to verify write permission enforcement.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:47.904869008Z","updated_at":"2026-01-21T13:31:14.954985266Z","closed_at":"2026-01-21T13:31:14.954985266Z","close_reason":"Added requireWrite middleware to events POST/PUT/PATCH/DELETE with comprehensive role-based tests and authentication on GET endpoints","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-u8t","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:38.296093332Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-uil","title":"Backend: Update leases route for batch property ID queries","description":"## Overview\n\nUpdate the GET /api/leases route to handle array of property IDs and use Prisma's 'in' operator for batch querying. This eliminates N+1 query patterns.\n\n## Files\n\n- Modify: `server/src/routes/leases.ts` (lines 9-59)\n\n## Implementation Steps\n\n### Step 1: Review current implementation\n\nRead `server/src/routes/leases.ts` GET handler to understand current filtering logic.\n\nCurrent code (around line 22-37):\n```javascript\nconst { property_id, tenant_id, status } = validationResult.data;\n\nconst where: any = {};\n\nif (property_id) {\n  where.propertyId = property_id;\n}\n```\n\n### Step 2: Update to handle array property IDs\n\nReplace the property_id handling with array normalization:\n\n```javascript\nconst { property_id, tenant_id, status } = validationResult.data;\n\nconst where: any = {};\n\nif (property_id) {\n  // Normalize to array - works for both single and multiple IDs\n  const propertyIds = Array.isArray(property_id) ? property_id : [property_id];\n  where.propertyId = { in: propertyIds };\n}\n```\n\n### Step 3: Verify no other changes needed\n\nThe rest of the route handler remains unchanged:\n- `tenant_id` handling stays the same\n- `status` handling stays the same\n- `include` clause for property and tenant stays the same\n- `orderBy` stays the same\n\n### Step 4: Test locally\n\nStart the development server:\n```bash\nnpm run dev:server\n```\n\nTest single property ID:\n```bash\ncurl \"http://localhost:3000/api/leases?property_id=VALID_UUID_HERE\"\n```\n\nTest multiple property IDs (if you have test data):\n```bash\ncurl \"http://localhost:3000/api/leases?property_id=UUID1\u0026property_id=UUID2\"\n```\n\nExpected: Both return valid lease data with property and tenant included\n\n### Step 5: Commit\n\n```bash\ngit add server/src/routes/leases.ts\ngit commit -m \"feat(api): support batch property ID queries in leases endpoint\n\n- Normalize property_id to array (single or multiple)\n- Use Prisma 'in' operator for batch queries\n- Backward compatible with single property_id parameter\n- Enables N+1 elimination in frontend\n\nCo-Authored-By: Claude Sonnet 4.5 \u003cnoreply@anthropic.com\u003e\"\n```\n\n## Verification\n\n1. Code updated to normalize and use 'in' operator\n2. Server starts without errors\n3. Single property_id queries work\n4. Multiple property_id queries work (if test data available)\n5. Existing tests still pass: `npm test server/src/routes/__tests__/leases.test.ts`\n\n## Notes\n\n- Prisma's 'in' operator works efficiently with both single and multiple IDs\n- Array of length 1 has same performance as equality check\n- This change is fully backward compatible","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-17T18:01:26.554764966Z","updated_at":"2026-01-17T18:31:44.439387703Z","closed_at":"2026-01-17T18:31:44.439387703Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-uil","depends_on_id":"Task-mju","type":"blocks","created_at":"2026-01-17T18:02:03.588130032Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-usd","title":"Update user validation schemas for roles","description":"## Overview\nExtend user validation schemas to support role-based access control. Add validation for role field in user creation and dedicated schema for role updates.\n\n## Files to Modify\n- **Modify**: `shared/validation/user.validation.ts` - Add role validation schemas\n- **Modify**: `shared/validation/index.ts` - Export new schemas\n\n## Implementation Steps\n\n### Step 1: Update shared/validation/user.validation.ts\n\n```typescript\n// shared/validation/user.validation.ts\nimport { z } from 'zod';\n\n/**\n * Role validation schema\n * Ensures role is one of the valid options\n */\nexport const RoleSchema = z.enum(['ADMIN', 'LANDLORD', 'VIEWER'], {\n  errorMap: () =\u003e ({ message: 'Role must be ADMIN, LANDLORD, or VIEWER' }),\n});\n\n/**\n * Schema for creating a new user\n * Role defaults to LANDLORD if not specified\n */\nexport const CreateUserSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z\n    .string()\n    .min(8, 'Password must be at least 8 characters')\n    .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')\n    .regex(/[a-z]/, 'Password must contain at least one lowercase letter')\n    .regex(/[0-9]/, 'Password must contain at least one number'),\n  name: z.string().min(1, 'Name is required').max(100, 'Name is too long'),\n  role: RoleSchema.optional().default('LANDLORD'),\n});\n\n/**\n * Schema for updating user information\n */\nexport const UpdateUserSchema = z.object({\n  email: z.string().email('Invalid email address').optional(),\n  name: z.string().min(1, 'Name is required').max(100, 'Name is too long').optional(),\n  password: z\n    .string()\n    .min(8, 'Password must be at least 8 characters')\n    .regex(/[A-Z]/, 'Password must contain at least one uppercase letter')\n    .regex(/[a-z]/, 'Password must contain at least one lowercase letter')\n    .regex(/[0-9]/, 'Password must contain at least one number')\n    .optional(),\n}).strict();\n\n/**\n * Schema for updating user role (admin-only operation)\n */\nexport const UpdateUserRoleSchema = z.object({\n  role: RoleSchema,\n});\n\n/**\n * Schema for user login\n */\nexport const LoginSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(1, 'Password is required'),\n});\n\n// Type exports\nexport type CreateUser = z.infer\u003ctypeof CreateUserSchema\u003e;\nexport type UpdateUser = z.infer\u003ctypeof UpdateUserSchema\u003e;\nexport type UpdateUserRole = z.infer\u003ctypeof UpdateUserRoleSchema\u003e;\nexport type Login = z.infer\u003ctypeof LoginSchema\u003e;\nexport type Role = z.infer\u003ctypeof RoleSchema\u003e;\n```\n\n### Step 2: Update shared/validation/index.ts\n\nAdd exports for the new schemas:\n\n```typescript\n// Update user validation exports\nexport {\n  CreateUserSchema,\n  UpdateUserSchema,\n  UpdateUserRoleSchema,\n  RoleSchema,\n  LoginSchema,\n  type CreateUser,\n  type UpdateUser,\n  type UpdateUserRole,\n  type Login,\n  type Role,\n} from './user.validation';\n```\n\n## Verification Steps\n\n1. **Run TypeScript Compilation**\n   ```bash\n   npx tsc --noEmit\n   ```\n   Should complete without errors.\n\n2. **Test Schema Validation**\n   Create a test or verify in Node REPL:\n   ```typescript\n   import { RoleSchema, CreateUserSchema, UpdateUserRoleSchema } from '../shared/validation';\n   \n   // Should pass\n   RoleSchema.parse('ADMIN');\n   RoleSchema.parse('LANDLORD');\n   RoleSchema.parse('VIEWER');\n   \n   // Should fail\n   try {\n     RoleSchema.parse('INVALID');\n   } catch (e) {\n     console.log('Correctly rejected invalid role');\n   }\n   \n   // Should default to LANDLORD\n   const user = CreateUserSchema.parse({\n     email: 'test@example.com',\n     password: 'Test1234',\n     name: 'Test User'\n   });\n   console.log(user.role); // 'LANDLORD'\n   ```\n\n3. **Run Existing Tests**\n   ```bash\n   npm test -- validation\n   ```\n   Ensure no existing tests are broken.\n\n## Notes\n\n- RoleSchema uses z.enum for strict type checking\n- CreateUserSchema defaults role to 'LANDLORD' for new users\n- UpdateUserRoleSchema is separate for admin-only role updates\n- Password validation requires: 8+ chars, uppercase, lowercase, number\n- All schemas export both the schema and inferred TypeScript types\n- These schemas will be used by both API endpoints and frontend forms\n\n## Commit Message\n```\nfeat: add role validation schemas\n\n- Add RoleSchema with ADMIN, LANDLORD, VIEWER enum\n- Update CreateUserSchema with optional role field (defaults to LANDLORD)\n- Add UpdateUserRoleSchema for role changes\n- Export new schemas and types from shared/validation/index.ts\n- Maintain existing password and user validation rules\n```","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-17T17:57:49.086762616Z","updated_at":"2026-01-17T23:15:07.587362774Z","closed_at":"2026-01-17T23:15:07.587362774Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-usd","depends_on_id":"Task-asm","type":"blocks","created_at":"2026-01-17T18:01:13.029429833Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-vi5","title":"Fix Rate Limiting","description":"## Overview\nCurrent rate limiting is too strict (100 requests per 15 minutes) causing users to get locked out during normal usage. Implement tiered rate limiting with generous general limits and stricter login limits.\n\n## Files to Modify\n- `server/src/app.ts` - Update rate limiting configuration\n\n## Implementation Steps\n\n### Step 1: Update server/src/app.ts\nReplace the current rate limiter (lines 39-44):\n```typescript\nconst limiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 100,\n  message: 'Too many requests from this IP, please try again later.',\n});\napp.use('/api', limiter);\n```\n\nWith tiered rate limiting:\n```typescript\n// General API rate limit - generous for normal usage\nconst apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 1000, // 1000 requests per 15 minutes\n  message: 'Too many requests, please try again later.',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Strict rate limit for login to prevent brute force\nconst loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 20, // 20 login attempts per 15 minutes\n  message: 'Too many login attempts, please try again later.',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Apply general limiter to all API routes\napp.use('/api', apiLimiter);\n\n// Apply stricter limiter specifically to login endpoint\napp.use('/api/auth/login', loginLimiter);\n```\n\n### Step 2: Verify\nRun: `npm run dev`\n- Make multiple API requests rapidly - should not get rate limited\n- Test login endpoint still works\n\n### Step 3: Commit\n```bash\ngit add server/src/app.ts\ngit commit -m \"fix: adjust rate limiting to be less restrictive for normal usage\"\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T17:23:31.315363149Z","updated_at":"2026-01-15T18:06:33.303999832Z","closed_at":"2026-01-15T18:06:33.303999832Z","close_reason":"Closed","created_by":"Alexander Pezarro"}
{"id":"Task-vpz","title":"Global error handling with React error boundary, toast notifications using Material-UI Snackbar, loading states, and standardized error response handling in API client","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T10:48:19.94502315Z","updated_at":"2026-01-14T07:24:10.203830072Z","closed_at":"2026-01-14T07:24:10.203830072Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-vpz","depends_on_id":"Task-atm","type":"blocks","created_at":"2026-01-13T11:16:12.724604229Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-vpz","depends_on_id":"Task-1ks","type":"blocks","created_at":"2026-01-13T11:16:13.276350335Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-wx4","title":"Add requireWrite middleware to properties routes","description":"Modify server/src/routes/properties.ts to add requireWrite() middleware to POST/PUT/DELETE endpoints. Update corresponding tests in server/src/routes/__tests__/properties.test.ts to verify that users with VIEWER role are blocked from write operations while users with EDITOR or ADMIN roles can perform writes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-17T17:58:42.230220005Z","updated_at":"2026-01-21T13:23:06.118951331Z","closed_at":"2026-01-21T13:23:06.118951331Z","close_reason":"Added requireWrite middleware to properties POST/PUT/DELETE routes with comprehensive role-based tests, and fixed missing authentication on GET endpoints","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-wx4","depends_on_id":"Task-c8y","type":"blocks","created_at":"2026-01-17T18:01:35.217906341Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-x86","title":"Transaction audit logging","description":"Implement TransactionAuditLog creation for all edits to imported transactions. Track field, oldValue, newValue, userId, and timestamp. Add GET /api/transactions/:id/audit-log endpoint.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:37.740590407Z","updated_at":"2026-01-24T18:25:24.561112035Z","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-x86","depends_on_id":"Task-hkn","type":"parent-child","created_at":"2026-01-20T18:29:03.862808775Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-xci","title":"Matching rules editor with visual builder","description":"Create /admin/bank-accounts/:id/rules page with RuleEditor component featuring visual condition builder for AND/OR logic, draggable reordering, and rule testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:22.774353901Z","updated_at":"2026-01-24T17:18:18.927227707Z","closed_at":"2026-01-24T17:18:18.927227707Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-xci","depends_on_id":"Task-n4r","type":"blocks","created_at":"2026-01-20T18:31:56.184640472Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-xci","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:56.816481798Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-y0b","title":"Bulk operations UI","description":"Implement bulk selection and actions for pending transactions: bulk approve, bulk update (same values), and bulk reject","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:24.413411887Z","updated_at":"2026-01-24T14:48:02.689763422Z","closed_at":"2026-01-24T14:48:02.689763422Z","close_reason":"Bulk operations implementation complete - all tests passing (43/43), all code quality issues resolved, grade A-","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-y0b","depends_on_id":"Task-2bt","type":"blocks","created_at":"2026-01-20T18:31:57.367171292Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-y0b","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:58.045796332Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-z1v","title":"Update Seed Data with Dynamic Dates","description":"## Overview\nSeed data has hardcoded dates from 2023-2024, so dashboard shows £0 for current month. Update seed.ts to use relative dates so data is always relevant.\n\n## Files to Modify\n- `prisma/seed.ts` - Update all date references to be relative to current date\n\n## Implementation Steps\n\n### Step 1: Add date helper functions at top of seed.ts (after imports)\n```typescript\n// Helper functions for relative dates\nfunction getRelativeDate(monthsAgo: number, day: number = 1): Date {\n  const date = new Date();\n  date.setMonth(date.getMonth() - monthsAgo);\n  date.setDate(day);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nfunction getFutureDate(daysAhead: number): Date {\n  const date = new Date();\n  date.setDate(date.getDate() + daysAhead);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n```\n\n### Step 2: Update seedLeases function\nReplace hardcoded dates with relative dates:\n- Active leases: startDate = 6-12 months ago, endDate = 6-12 months from now\n- Expired lease: startDate = 18 months ago, endDate = 2 months ago\n- Pending lease: startDate = 1 month from now\n\nExample changes:\n```typescript\n// Active lease - started 6 months ago, ends in 6 months\nstartDate: getRelativeDate(6, 1),\nendDate: getFutureDate(180),\n\n// Expired lease - ended 2 months ago\nstartDate: getRelativeDate(18, 1),\nendDate: getRelativeDate(2, 28),\n```\n\n### Step 3: Update seedTransactions function\nReplace hardcoded dates to include current and recent months:\n- Rent payments: current month (day 1), last month, 2 months ago\n- Expenses: spread across last 3 months\n\nExample:\n```typescript\n// Current month rent\ntransactionDate: getRelativeDate(0, 1),\ndescription: 'Monthly rent - current month',\n\n// Last month rent\ntransactionDate: getRelativeDate(1, 1),\ndescription: 'Monthly rent - last month',\n```\n\n### Step 4: Update seedEvents function\nReplace hardcoded dates:\n- Completed events: 1-2 months ago\n- Upcoming events: 7, 14, 30, 45, 60 days in future\n\nExample:\n```typescript\n// Completed event\nscheduledDate: getRelativeDate(1, 15),\ncompleted: true,\ncompletedDate: getRelativeDate(1, 15),\n\n// Upcoming event\nscheduledDate: getFutureDate(14),\ncompleted: false,\n```\n\n### Step 5: Verify\nRun: `npm run db:reset \u0026\u0026 npm run db:seed`\nRun: `npm run dev`\nDashboard should show non-zero income/expenses for current month\n\n### Step 6: Commit\n```bash\ngit add prisma/seed.ts\ngit commit -m \"fix: update seed data to use relative dates for dashboard\"\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T17:23:35.793109652Z","updated_at":"2026-01-15T18:06:33.326664093Z","closed_at":"2026-01-15T18:06:33.326664093Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-z1v","depends_on_id":"Task-860","type":"blocks","created_at":"2026-01-15T17:25:03.93487816Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-zc7","title":"Webhook status monitoring","description":"Dashboard widget showing webhook health: last event timestamp, delivery status, failure alerts, and quick actions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-20T18:27:21.935013641Z","updated_at":"2026-01-24T17:47:49.045147715Z","closed_at":"2026-01-24T17:47:49.045147715Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-zc7","depends_on_id":"Task-7qr","type":"parent-child","created_at":"2026-01-20T18:28:56.217639832Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-zc7","depends_on_id":"Task-n4r","type":"blocks","created_at":"2026-01-20T18:31:55.611333937Z","created_by":"Alexander Pezarro"}]}
{"id":"Task-ztd","title":"Implement Documents Page","description":"## Overview\nReplace the placeholder Documents page with a full implementation for uploading, viewing, and managing documents associated with entities (Property, Tenant, Lease, Transaction).\n\n## Files to Modify\n- `client/src/pages/Documents.tsx` - Complete rewrite\n\n## Implementation Steps\n\n### Step 1: Set up the page structure\nState management:\n- documents: Document[]\n- loading, error states\n- Filters: entityTypeFilter, entityIdFilter\n- Upload dialog: uploadDialogOpen, selectedFile, selectedEntityType, selectedEntityId\n- Delete dialog: deleteDialogOpen, documentToDelete\n\n### Step 2: Add entity fetching\nNeed to fetch lists of each entity type for dropdown:\n```typescript\nconst [properties, setProperties] = useState\u003cProperty[]\u003e([]);\nconst [tenants, setTenants] = useState\u003cTenant[]\u003e([]);\nconst [leases, setLeases] = useState\u003cLease[]\u003e([]);\nconst [transactions, setTransactions] = useState\u003cTransaction[]\u003e([]);\n\n// Fetch all in useEffect\nuseEffect(() =\u003e {\n  Promise.all([\n    propertiesService.getProperties(),\n    tenantsService.getTenants(),\n    leasesService.getLeases(),\n    transactionsService.getTransactions(),\n  ]).then(([props, tens, leas, trans]) =\u003e {\n    setProperties(props);\n    setTenants(tens);\n    setLeases(leas);\n    setTransactions(trans);\n  });\n}, []);\n```\n\n### Step 3: Add fetch documents function\n```typescript\nconst fetchDocuments = async () =\u003e {\n  try {\n    setLoading(true);\n    const entityType = entityTypeFilter !== 'all' ? entityTypeFilter : undefined;\n    const entityId = entityIdFilter !== 'all' ? entityIdFilter : undefined;\n    const docs = await documentsService.getDocuments(entityType, entityId);\n    setDocuments(docs);\n  } catch (err) {\n    setError('Failed to load documents');\n  } finally {\n    setLoading(false);\n  }\n};\n```\n\n### Step 4: Add filter UI\n- Entity Type dropdown: All, Property, Tenant, Lease, Transaction\n- Entity dropdown (changes based on entity type selection)\n  - If Property: show property names\n  - If Tenant: show tenant names\n  - etc.\n\n### Step 5: Add document list\nTable or cards showing:\n- File name\n- Entity type badge\n- Entity name (lookup from fetched entities)\n- File type (show icon for PDF/image)\n- File size (formatted KB/MB)\n- Upload date\n- Actions: Download, Delete buttons\n\n### Step 6: Add upload dialog\n- Entity Type select (required)\n- Entity select (required, options change based on type)\n- File input with drag-drop or click to select\n- Show file name and size after selection\n- Validate: PDF, JPG, PNG only, max 10MB\n- Upload button\n\n### Step 7: Add handlers\n```typescript\nconst handleUpload = async () =\u003e {\n  if (!selectedFile || !selectedEntityType || !selectedEntityId) return;\n  try {\n    await documentsService.uploadDocument(selectedFile, selectedEntityType, selectedEntityId);\n    toast.success('Document uploaded successfully');\n    handleCloseUploadDialog();\n    fetchDocuments();\n  } catch (err) {\n    toast.error('Failed to upload document');\n  }\n};\n\nconst handleDownload = async (doc: Document) =\u003e {\n  const blob = await documentsService.downloadDocument(doc.id);\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = doc.fileName;\n  a.click();\n  URL.revokeObjectURL(url);\n};\n\nconst handleDelete = async () =\u003e {\n  if (!documentToDelete) return;\n  await documentsService.deleteDocument(documentToDelete.id);\n  toast.success('Document deleted');\n  fetchDocuments();\n};\n```\n\n### Step 8: Verify\nRun: `npm run dev`\n- Navigate to Documents page\n- Upload a document (PDF or image)\n- Download a document\n- Delete a document\n- Filter by entity type\n\n### Step 9: Commit\n```bash\ngit add client/src/pages/Documents.tsx\ngit commit -m \"feat: implement full Documents page with upload/download\"\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T17:24:39.168286178Z","updated_at":"2026-01-15T19:02:39.014957228Z","closed_at":"2026-01-15T19:02:39.014957228Z","close_reason":"Closed","created_by":"Alexander Pezarro","dependencies":[{"issue_id":"Task-ztd","depends_on_id":"Task-860","type":"blocks","created_at":"2026-01-15T17:25:05.044802377Z","created_by":"Alexander Pezarro"},{"issue_id":"Task-ztd","depends_on_id":"Task-18u","type":"blocks","created_at":"2026-01-15T17:25:05.593660362Z","created_by":"Alexander Pezarro"}]}
